<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø± Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Google Fonts: Tajawal + Cairo -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&family=Cairo:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        * { font-family: 'Cairo', 'Tajawal', sans-serif; }
        body { background: linear-gradient(145deg, #f1f5f9 0%, #ffffff 100%); scroll-behavior: smooth; }
        .glass-morphism { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .course-card, .book-card, .announcement-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid rgba(0,0,0,0.03); }
        .course-card:hover, .book-card:hover, .announcement-card:hover { transform: translateY(-8px); box-shadow: 0 25px 30px -12px rgba(0, 119, 255, 0.15); border-color: rgba(37, 99, 235, 0.2); }
        .loader { border-top-color: #2563eb; animation: spinner 0.8s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .whatsapp-float { position: fixed; bottom: 25px; right: 25px; background: #25d366; color: white; width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; box-shadow: 0 10px 25px rgba(37, 211, 102, 0.4); z-index: 50; transition: 0.3s; }
        .whatsapp-float:hover { transform: scale(1.1) rotate(5deg); }
        .hidden-content { filter: blur(6px); pointer-events: none; user-select: none; }
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; background: white; padding: 14px 28px; border-radius: 60px; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.2); border-right: 6px solid; font-weight: 700; display: flex; align-items: center; gap: 12px; opacity: 0; transition: opacity 0.3s; }
        .toast.show { opacity: 1; }
        .toast.success { border-color: #10b981; background: #f0fdf9; color: #065f46; }
        .toast.error { border-color: #ef4444; background: #fef2f2; color: #991b1b; }
        .toast.info { border-color: #3b82f6; background: #eff6ff; color: #1e3a8a; }
        .active-nav { color: #2563eb !important; font-weight: 900; position: relative; }
        .active-nav::after { content: ''; position: absolute; bottom: -6px; right: 0; width: 100%; height: 3px; background: #2563eb; border-radius: 3px; }
        .profile-card { background: linear-gradient(145deg, #ffffff, #f9fafc); box-shadow: 0 15px 35px -10px rgba(0,0,0,0.1); }
        .gradient-text { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>

<!-- Toast Container -->
<div id="toast" class="toast hidden">
    <span id="toastIcon">âœ…</span>
    <span id="toastMessage">Ø±Ø³Ø§Ù„Ø©</span>
</div>

<!-- Google Login Config -->
<div id="g_id_onload"
     data-client_id="583210084990-m5j5pkdp63s255aci47grhdhef5rfk9s.apps.googleusercontent.com"
     data-context="signin"
     data-ux_mode="popup"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>

<div id="app" class="min-h-screen flex flex-col">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white/80 backdrop-blur-sm z-[200] flex items-center justify-center hidden">
        <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-14 w-14"></div>
    </div>

    <!-- Navigation -->
    <nav class="glass-morphism sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-6">
                    <div class="text-2xl font-black bg-gradient-to-l from-blue-700 to-blue-500 bg-clip-text text-transparent cursor-pointer" onclick="showPage('home')">Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø±</div>
                    <div class="hidden md:flex space-x-reverse space-x-6 text-gray-700 font-medium">
                        <a href="#" onclick="showPage('home')" class="nav-link hover:text-blue-600 transition">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                        <a href="#" onclick="showPage('courses')" class="nav-link hover:text-blue-600 transition">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</a>
                        <a href="#" onclick="showPage('library')" class="nav-link hover:text-blue-600 transition">Ø§Ù„Ù…ÙƒØªØ¨Ø©</a>
                        <a href="#" onclick="showPage('announcements')" class="nav-link hover:text-blue-600 transition">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</a>
                        <span id="adminLink" class="hidden">
                            <a href="#" onclick="showPage('admin')" class="text-red-600 font-bold hover:underline">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
                        </span>
                        <span id="profileLink" class="hidden">
                            <a href="#" onclick="showPage('profile')" class="nav-link hover:text-blue-600 transition">Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</a>
                        </span>
                    </div>
                </div>
                <div id="authSection" class="flex items-center gap-3"></div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8">
        
        <!-- Registration/Profile Modal (Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…) -->
        <div id="joining-gateway" class="fixed inset-0 z-[100] bg-black/60 flex items-center justify-center hidden p-4 backdrop-blur-lg">
            <div class="bg-white w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl border-2 border-blue-100 fade-in">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-br from-blue-100 to-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 shadow-inner">
                        <span class="text-4xl">ğŸ“</span>
                    </div>
                    <h2 class="text-3xl font-black text-gray-900">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h2>
                    <p class="text-gray-500 mt-2">Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„ØªØµØ¨Ø­ Ø¬Ø²Ø¡Ù‹Ø§ Ù…Ù† Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„ÙØ±Ø¹ÙˆÙ†</p>
                </div>
                
                <form id="profileForm" class="space-y-5">
                    <div class="space-y-1">
                        <label class="block text-sm font-bold text-gray-700 mr-2 flex items-center gap-1"><span>ğŸ“</span> Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                        <select id="userGrade" class="w-full p-4 bg-gray-50 border-2 border-transparent focus:border-blue-500 rounded-2xl outline-none transition" required>
                            <option value="">Ø§Ø®ØªØ± ØµÙÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</option>
                            <option value="1">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                            <option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                            <option value="3">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                        </select>
                    </div>
                    <div class="space-y-1">
                        <label class="block text-sm font-bold text-gray-700 mr-2 flex items-center gap-1"><span>ğŸ“±</span> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆØ§ØªØ³Ø§Ø¨)</label>
                        <input type="tel" id="userPhone" placeholder="01xxxxxxxxx" class="w-full p-4 bg-gray-50 border-2 border-transparent focus:border-blue-500 rounded-2xl outline-none transition" required>
                    </div>
                    <div class="space-y-1">
                        <label class="block text-sm font-bold text-gray-700 mr-2 flex items-center gap-1"><span>ğŸ”</span> ÙƒÙŠÙ Ø³Ù…Ø¹Øª Ø¹Ù† Ø§Ù„Ø£Ø³ØªØ§Ø°ØŸ</label>
                        <select id="discoverySource" class="w-full p-4 bg-gray-50 border-2 border-transparent focus:border-blue-500 rounded-2xl outline-none transition">
                            <option value="facebook">ÙÙŠØ³Ø¨ÙˆÙƒ</option>
                            <option value="youtube">ÙŠÙˆØªÙŠÙˆØ¨</option>
                            <option value="friend">ØªØ±Ø´ÙŠØ­ Ù…Ù† ØµØ¯ÙŠÙ‚</option>
                            <option value="tiktok">ØªÙŠÙƒ ØªÙˆÙƒ</option>
                            <option value="other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full py-4 bg-gradient-to-l from-blue-700 to-blue-500 text-white rounded-2xl font-black text-lg hover:shadow-xl transform active:scale-95 transition shadow-lg shadow-blue-200">
                        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </form>
            </div>
        </div>

        <!-- Subscription Modal -->
        <div id="subscribe-modal" class="fixed inset-0 z-[100] bg-black/60 flex items-center justify-center hidden p-4 backdrop-blur-sm">
            <div class="bg-white w-full max-w-md rounded-3xl p-8 shadow-2xl relative border border-blue-100">
                <button onclick="closeSubscribeModal()" class="absolute top-5 left-5 text-gray-400 hover:text-black transition text-xl">âœ•</button>
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-blue-700">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h2>
                    <div class="mt-4 p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border border-blue-200">
                        <p class="text-sm text-blue-800">Ù‚Ù… Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ø¨Ø± ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ù„Ù„Ø±Ù‚Ù…:</p>
                        <p class="text-3xl font-black text-blue-900 mt-1 tracking-widest">Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©</p>
                    </div>
                </div>
                
                <form id="subscribeForm" class="space-y-4">
                    <input type="hidden" id="subCourseId">
                    <input type="hidden" id="subCourseTitle">
                    <input type="text" id="subName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                    <input type="tel" id="subWhatsapp" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                    <input type="tel" id="subSenderPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡Ø§" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                    <button type="submit" class="w-full py-4 bg-gradient-to-l from-green-600 to-green-500 text-white rounded-2xl font-bold text-lg hover:shadow-xl transition shadow-lg flex items-center justify-center gap-2">
                        <span>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„ÙØ±Ø¹ÙˆÙ†</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                    </button>
                </form>
            </div>
        </div>

        <!-- Home Page -->
        <section id="page-home" class="page-content">
            <div class="text-center py-24 bg-white/70 rounded-[3rem] shadow-xl border border-white/50 mb-12 relative overflow-hidden backdrop-blur-sm">
                <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-l from-blue-600 to-blue-400"></div>
                <div class="inline-block px-6 py-2 bg-blue-100 text-blue-700 rounded-full text-sm font-bold mb-6 shadow-sm">Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø±Ø³Ù…ÙŠØ© ğŸ†</div>
                <h1 class="text-5xl md:text-8xl font-black text-gray-900 mb-8 leading-tight">Ù…Ù„Ùƒ Ø§Ù„Ù„ØºÙ‡ Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ‡ <br><span class="gradient-text">Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø±</span></h1>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto mb-12 leading-relaxed">Ø£Ø¨Ø³Ø· Ø´Ø±Ø­ØŒ Ø£Ù‚ÙˆÙ‰ Ù…Ù„Ø§Ø²Ù…ØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ø­ØªÙ‰ Ø¨Ø§Ø¨ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†. Ø§Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ‡  Ø£ØµØ¨Ø­Øª Ø£Ø³Ù‡Ù„ Ø§Ù„Ø¢Ù†.</p>
                <div class="flex flex-wrap justify-center gap-5">
                    <button onclick="showPage('courses')" class="px-12 py-5 bg-gradient-to-l from-blue-700 to-blue-500 text-white rounded-3xl font-black text-xl shadow-2xl shadow-blue-200 hover:shadow-blue-300 transform hover:-translate-y-1 transition duration-300">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¢Ù†</button>
                    <a href="https://wa.me/+201273740256" target="_blank" class="px-12 py-5 bg-white border-4 border-blue-600 text-blue-600 rounded-3xl font-black text-xl hover:bg-blue-50 transition duration-300 flex items-center gap-2">ØªØ­Ø¯Ø« Ù…Ø¹Ù†Ø§</a>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                <div class="p-10 bg-white rounded-[2rem] shadow-sm border border-gray-100 text-center hover:border-blue-200 transition hover:shadow-xl">
                    <div class="w-20 h-20 bg-blue-100 text-blue-600 rounded-3xl flex items-center justify-center text-4xl mx-auto mb-6">âœï¸</div>
                    <h3 class="text-2xl font-black mb-3 text-gray-800">Ù…Ù„Ø§Ø²Ù… Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h3>
                    <p class="text-gray-500 leading-relaxed">Ø®Ø±Ø§Ø¦Ø· Ø°Ù‡Ù†ÙŠØ© ÙˆØªÙ„Ø®ÙŠØµØ§Øª Ø´Ø§Ù…Ù„Ø© ØªØ¬Ø¹Ù„ Ø§Ù„ØµØ¹Ø¨ Ø³Ù‡Ù„Ø§Ù‹ Ø¬Ø¯Ø§Ù‹.</p>
                </div>
                <div class="p-10 bg-white rounded-[2rem] shadow-sm border border-gray-100 text-center hover:border-green-200 transition hover:shadow-xl">
                    <div class="w-20 h-20 bg-green-100 text-green-600 rounded-3xl flex items-center justify-center text-4xl mx-auto mb-6">âœ…</div>
                    <h3 class="text-2xl font-black mb-3 text-gray-800">Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙÙˆØ±ÙŠØ©</h3>
                    <p class="text-gray-500 leading-relaxed">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯ ÙƒÙ„ Ø­ØµØ© Ù„ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙˆØ§Ùƒ Ù„Ø­Ø¸Ø© Ø¨Ù„Ø­Ø¸Ø©.</p>
                </div>
                <div class="p-10 bg-white rounded-[2rem] shadow-sm border border-gray-100 text-center hover:border-purple-200 transition hover:shadow-xl">
                    <div class="w-20 h-20 bg-purple-100 text-purple-600 rounded-3xl flex items-center justify-center text-4xl mx-auto mb-6">ğŸ¥</div>
                    <h3 class="text-2xl font-black mb-3 text-gray-800">Ø¬ÙˆØ¯Ø© 4K</h3>
                    <p class="text-gray-500 leading-relaxed">ØªØµÙˆÙŠØ± Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙŠØ¬Ø¹Ù„Ùƒ ØªØ¹ÙŠØ´ Ø¬Ùˆ Ø§Ù„Ø­ØµØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.</p>
                </div>
            </div>
        </section>

        <!-- Courses Page -->
        <section id="page-courses" class="page-content hidden">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-black text-gray-900 mb-4">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</h2>
                <div class="w-24 h-2 bg-gradient-to-l from-blue-600 to-blue-400 mx-auto rounded-full"></div>
            </div>
            
            <div id="gradeSelector" class="flex flex-wrap gap-4 mb-12 justify-center">
                <button onclick="filterByGrade('all')" class="grade-btn px-8 py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-full font-bold shadow-sm hover:border-blue-400 transition">Ø§Ù„ÙƒÙ„</button>
                <button onclick="filterByGrade('1')" class="grade-btn px-8 py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-full font-bold hover:border-blue-400 transition">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</button>
                <button onclick="filterByGrade('2')" class="grade-btn px-8 py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-full font-bold hover:border-blue-400 transition">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</button>
                <button onclick="filterByGrade('3')" class="grade-btn px-8 py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-full font-bold hover:border-blue-400 transition">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</button>
            </div>

            <div id="coursesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                <div class="col-span-full flex flex-col items-center py-20">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
                    <p class="text-gray-500 font-bold">ÙŠØªÙ… Ø§Ù„Ø¢Ù† ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª...</p>
                </div>
            </div>
        </section>

        <!-- Library Page (Ø§Ù„Ù…Ù„Ø§Ø²Ù…) -->
        <section id="page-library" class="page-content hidden">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-black text-gray-900 mb-4">Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h2>
                <div class="w-24 h-2 bg-gradient-to-l from-green-600 to-green-400 mx-auto rounded-full"></div>
            </div>
            
            <div id="booksList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                <div class="col-span-full flex flex-col items-center py-20">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
                    <p class="text-gray-500 font-bold">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø²Ù…...</p>
                </div>
            </div>
        </section>

        <!-- Announcements Page -->
        <section id="page-announcements" class="page-content hidden">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-black text-gray-900 mb-4">Ø¢Ø®Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h2>
                <div class="w-24 h-2 bg-gradient-to-l from-yellow-600 to-yellow-400 mx-auto rounded-full"></div>
            </div>
            
            <div id="announcementsList" class="grid grid-cols-1 gap-6 max-w-4xl mx-auto">
                <div class="col-span-full flex flex-col items-center py-20">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
                    <p class="text-gray-500 font-bold">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...</p>
                </div>
            </div>
        </section>

        <!-- Profile Page -->
        <section id="page-profile" class="page-content hidden">
            <div class="max-w-3xl mx-auto">
                <div class="bg-white/80 backdrop-blur-sm rounded-[2.5rem] shadow-2xl border border-gray-100 p-8 md:p-12 profile-card">
                    <h2 class="text-3xl font-black text-gray-900 mb-8 flex items-center gap-3">
                        <span class="w-2 h-10 bg-blue-600 rounded-full"></span>
                        Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                    </h2>
                    
                    <form id="updateProfileForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø§Ø³Ù…</label>
                                <input type="text" id="profileName" class="w-full p-4 bg-gray-100 border border-gray-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" id="profileEmail" class="w-full p-4 bg-gray-100 border border-gray-200 rounded-2xl outline-none" readonly>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-1">ğŸ“ Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                            <select id="profileGrade" class="w-full p-4 bg-white border-2 border-gray-200 rounded-2xl outline-none focus:border-blue-500 transition" required>
                                <option value="1">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="3">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-1">ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆØ§ØªØ³Ø§Ø¨)</label>
                            <input type="tel" id="profilePhone" class="w-full p-4 bg-white border-2 border-gray-200 rounded-2xl outline-none focus:border-blue-500 transition" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-1">ğŸ” Ù…ØµØ¯Ø± Ø§Ù„ØªØ¹Ø±ÙŠÙ</label>
                            <select id="profileSource" class="w-full p-4 bg-white border-2 border-gray-200 rounded-2xl outline-none focus:border-blue-500 transition">
                                <option value="facebook">ÙÙŠØ³Ø¨ÙˆÙƒ</option>
                                <option value="youtube">ÙŠÙˆØªÙŠÙˆØ¨</option>
                                <option value="friend">ØªØ±Ø´ÙŠØ­ Ù…Ù† ØµØ¯ÙŠÙ‚</option>
                                <option value="tiktok">ØªÙŠÙƒ ØªÙˆÙƒ</option>
                                <option value="other">Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="w-full py-5 bg-gradient-to-l from-blue-600 to-blue-500 text-white rounded-2xl font-black text-lg shadow-xl hover:shadow-2xl transform hover:-translate-y-1 transition">
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Admin Page -->
        <section id="page-admin" class="page-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Sidebar Tabs for Admin -->
                <div class="lg:col-span-1">
                    <div class="bg-white/80 backdrop-blur-sm p-8 rounded-[2.5rem] shadow-xl border border-gray-100 sticky top-24">
                        <div class="flex flex-col gap-4">
                            <button onclick="showAdminTab('courses')" class="admin-tab-btn active-admin-tab px-6 py-4 bg-blue-600 text-white rounded-2xl font-black text-right shadow-md">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø©</button>
                            <button onclick="showAdminTab('books')" class="admin-tab-btn px-6 py-4 bg-gray-100 text-gray-700 rounded-2xl font-black text-right hover:bg-blue-100 transition">ğŸ“š Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø²Ù…Ø©</button>
                            <button onclick="showAdminTab('announcements')" class="admin-tab-btn px-6 py-4 bg-gray-100 text-gray-700 rounded-2xl font-black text-right hover:bg-blue-100 transition">ğŸ“¢ Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</button>
                            <button onclick="showAdminTab('requests')" class="admin-tab-btn px-6 py-4 bg-gray-100 text-gray-700 rounded-2xl font-black text-right hover:bg-blue-100 transition">ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„</button>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2 space-y-8">
                    <!-- Admin Tab: Courses -->
                    <div id="adminCoursesTab" class="admin-tab-content">
                        <div class="bg-white/80 backdrop-blur-sm p-8 rounded-[2.5rem] shadow-xl border border-gray-100">
                            <h3 class="font-black text-2xl mb-6 flex items-center gap-2">
                                <span class="w-2 h-8 bg-blue-600 rounded-full"></span>
                                Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                            </h3>
                            <form id="courseForm" class="space-y-4">
                                <input type="text" id="courseTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                                
                                <div class="grid grid-cols-2 gap-3">
                                    <select id="courseGrade" class="p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                                        <option value="1">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
                                        <option value="2">ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option>
                                        <option value="3">ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ</option>
                                    </select>
                                    <select id="courseType" class="p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                                        <option value="paid">Ù…Ø¯ÙÙˆØ¹</option>
                                        <option value="free">Ù…Ø¬Ø§Ù†ÙŠ</option>
                                    </select>
                                </div>

                                <input type="number" id="coursePrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                                
                                <div class="p-4 border-2 border-dashed rounded-2xl text-center bg-blue-50/50">
                                    <label class="text-xs font-bold text-blue-600 block mb-2">ØºÙ„Ø§Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© (ØµÙˆØ±Ø©)</label>
                                    <input type="file" id="courseImageFile" accept="image/*" class="text-xs w-full" required>
                                </div>
                                
                                <div class="p-4 border-2 border-dashed rounded-2xl text-center bg-red-50/50">
                                    <label class="text-xs font-bold text-red-600 block mb-2">ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</label>
                                    <input type="file" id="courseVideoFile" accept="video/*" class="text-xs w-full" required>
                                </div>

                                <textarea id="courseDesc" placeholder="ÙˆØµÙ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ø­ØªÙˆÙ‰..." class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl h-24 resize-none outline-none focus:ring-2 focus:ring-blue-300" required></textarea>
                                
                                <button type="submit" id="submitBtn" class="w-full py-5 bg-gradient-to-l from-blue-600 to-blue-500 text-white rounded-2xl font-black text-lg shadow-xl hover:shadow-2xl transition">Ù†Ø´Ø± Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</button>
                            </form>
                        </div>
                        
                        <div class="mt-8 bg-white/80 backdrop-blur-sm p-8 rounded-[2.5rem] shadow-lg border border-gray-100">
                            <h3 class="font-black text-2xl mb-6 flex items-center gap-2">
                                <span class="w-2 h-8 bg-purple-500 rounded-full"></span>
                                Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©
                            </h3>
                            <div id="adminCoursesList" class="grid grid-cols-1 gap-4"></div>
                        </div>
                    </div>

                    <!-- Admin Tab: Books -->
                    <div id="adminBooksTab" class="admin-tab-content hidden">
                        <div class="bg-white/80 backdrop-blur-sm p-8 rounded-[2.5rem] shadow-xl border border-gray-100">
                            <h3 class="font-black text-2xl mb-6 flex items-center gap-2">
                                <span class="w-2 h-8 bg-green-600 rounded-full"></span>
                                Ø±ÙØ¹ Ù…Ù„Ø²Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
                            </h3>
                            <form id="bookForm" class="space-y-4">
                                <input type="text" id="bookTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø²Ù…Ø©" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                                
                                <select id="bookGrade" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                                    <option value="1">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                    <option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                    <option value="3">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                </select>
                                
                                <div class="p-4 border-2 border-dashed rounded-2xl text-center bg-green-50/50">
                                    <label class="text-xs font-bold text-green-600 block mb-2">Ù…Ù„Ù PDF</label>
                                    <input type="file" id="bookFile" accept=".pdf" class="text-xs w-full" required>
                                </div>

                                <textarea id="bookDesc" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ù„Ø²Ù…Ø©..." class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl h-24 resize-none outline-none focus:ring-2 focus:ring-blue-300" required></textarea>
                                
                                <button type="submit" id="submitBookBtn" class="w-full py-5 bg-gradient-to-l from-green-600 to-green-500 text-white rounded-2xl font-black text-lg shadow-xl hover:shadow-2xl transition">Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ø²Ù…Ø©</button>
                            </form>
                        </div>
                        
                        <div class="mt-8 bg-white/80 backdrop-blur-sm p-8 rounded-[2.5rem] shadow-lg border border-gray-100">
                            <h3 class="font-black text-2xl mb-6 flex items-center gap-2">
                                <span class="w-2 h-8 bg-orange-500 rounded-full"></span>
                                Ø§Ù„Ù…Ù„Ø§Ø²Ù… Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©
                            </h3>
                            <div id="adminBooksList" class="grid grid-cols-1 gap-4"></div>
                        </div>
                    </div>

                    <!-- Admin Tab: Announcements -->
                    <div id="adminAnnouncementsTab" class="admin-tab-content hidden">
                        <div class="bg-white/80 backdrop-blur-sm p-8 rounded-[2.5rem] shadow-xl border border-gray-100">
                            <h3 class="font-black text-2xl mb-6 flex items-center gap-2">
                                <span class="w-2 h-8 bg-yellow-600 rounded-full"></span>
                                Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯
                            </h3>
                            <form id="announcementForm" class="space-y-4">
                                <input type="text" id="announcementTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-300" required>
                                
                                <textarea id="announcementContent" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†..." class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl h-32 resize-none outline-none focus:ring-2 focus:ring-blue-300" required></textarea>
                                
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="announcementImportant" class="w-5 h-5">
                                    <label for="announcementImportant" class="text-sm font-bold text-gray-700">Ø¥Ø¹Ù„Ø§Ù† Ù…Ù‡Ù… (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)</label>
                                </div>
                                
                                <button type="submit" id="submitAnnouncementBtn" class="w-full py-5 bg-gradient-to-l from-yellow-600 to-yellow-500 text-white rounded-2xl font-black text-lg shadow-xl hover:shadow-2xl transition">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
                            </form>
                        </div>
                        
                        <div class="mt-8 bg-white/80 backdrop-blur-sm p-8 rounded-[2.5rem] shadow-lg border border-gray-100">
                            <h3 class="font-black text-2xl mb-6 flex items-center gap-2">
                                <span class="w-2 h-8 bg-red-500 rounded-full"></span>
                                Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                            </h3>
                            <div id="adminAnnouncementsList" class="grid grid-cols-1 gap-4"></div>
                        </div>
                    </div>

                    <!-- Admin Tab: Requests -->
                    <div id="adminRequestsTab" class="admin-tab-content hidden">
                        <div class="bg-white/80 backdrop-blur-sm p-8 rounded-[2.5rem] shadow-lg border border-gray-100">
                            <h3 class="font-black text-2xl mb-6 flex items-center gap-2">
                                <span class="w-2 h-8 bg-green-500 rounded-full"></span>
                                Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„
                            </h3>
                            <div id="subRequestsList" class="space-y-4">
                                <p class="text-gray-400 text-center py-10">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙŠÙ†ØªØ¸Ø±ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- WhatsApp Float -->
    <a href="https://wa.me/+201273740256" target="_blank" class="whatsapp-float">
        <svg viewBox="0 0 24 24" width="35" height="35" fill="currentColor"><path d="M12.031 6.172c-2.32 0-4.591.398-6.758 1.147l-1.17.404-.774-2.83 2.851.744c2.257-.738 4.612-1.119 7.003-1.119 11.233 0 16.554 12.004 9.39 20.233l.118-.12c-2.103 1.9-4.778 2.853-7.692 2.853-2.13 0-4.215-.39-6.208-1.156l-1.18-.454-2.872.744.774-2.854-.454-1.188c-.776-2.034-1.17-4.175-1.17-6.363 0-5.362 2.112-10.402 5.947-14.197 3.835-3.795 8.937-5.885 14.364-5.885 10.434 0 18.913 8.479 18.913 18.913 0 5.103-1.986 9.897-5.592 13.503-3.606 3.606-8.4 5.592-13.321 5.592z"/></svg>
    </a>

    <!-- Footer -->
    <footer class="bg-slate-900 text-gray-300 mt-20 border-t border-gray-800 p-12 text-center">
        <div class="text-4xl font-black bg-gradient-to-l from-white to-gray-300 bg-clip-text text-transparent mb-4">Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø±</div>
        <p class="max-w-md mx-auto text-sm text-gray-500 mb-8">Ù…Ù„Ùƒ Ø§Ù„Ù†Ø­Ùˆ ÙˆØ§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©. Ù†Ø­Ù† Ù†ØµÙ†Ø¹ Ø§Ù„ØªÙÙˆÙ‚ Ø¨Ø°ÙƒØ§Ø¡.</p>
        <div class="flex justify-center gap-6 mb-8 text-gray-400">
            <a href="#" class="hover:text-blue-500 transition">ÙÙŠØ³Ø¨ÙˆÙƒ</a>
            <a href="#" class="hover:text-red-500 transition">ÙŠÙˆØªÙŠÙˆØ¨</a>
            <a href="#" class="hover:text-blue-400 transition">ØªÙ„ÙŠØ¬Ø±Ø§Ù…</a>
        </div>
        <div class="text-xs text-gray-700 font-bold border-t border-gray-800 pt-8">&copy; 2026 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù€ Ø¨Ø±Ø¡ Ø¹Ù…Ø± ÙˆÙ…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø±</div>
    </footer>
</div>

<!-- Firebase & Logic -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, onAuthStateChanged, signOut, signInWithCredential } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, serverTimestamp, setDoc, getDoc, updateDoc, orderBy, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

    // --- Firebase Config ---
    const firebaseConfig = {
        apiKey: "AIzaSyCoG63qojGugIkvc7-T0M7BnP4KRMQuyrE",
        authDomain: "mr-jabr.firebaseapp.com",
        projectId: "mr-jabr",
        storageBucket: "mr-jabr.firebasestorage.app",
        messagingSenderId: "563345828466",
        appId: "1:563345828466:web:f0bdd40711c935f60d30eb",
        measurementId: "G-C7L0T2QHL8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);
    const ADMIN_EMAIL = "bo2584668@gmail.com";

    // --- State ---
    let currentUser = null;
    let currentUserProfile = null;
    let currentFilterGrade = 'all';
    let allCourses = [];
    let allBooks = [];
    let allAnnouncements = [];
    let mySubscriptions = [];
    let isLoadingUser = true;
    let isProfileComplete = false;

    // --- UI Elements ---
    const loadingOverlay = document.getElementById('loadingOverlay');
    const joiningGateway = document.getElementById('joining-gateway');
    const authSection = document.getElementById('authSection');
    const adminLink = document.getElementById('adminLink');
    const profileLink = document.getElementById('profileLink');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    const toastIcon = document.getElementById('toastIcon');

    // --- Toast Function ---
    function showToast(message, type = 'info') {
        const icons = {
            success: 'âœ…',
            error: 'âŒ',
            info: 'â„¹ï¸'
        };
        toastIcon.textContent = icons[type] || 'â„¹ï¸';
        toastMessage.textContent = message;
        toast.className = `toast ${type} show`;
        toast.classList.remove('hidden');
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.classList.add('hidden'), 300);
        }, 3000);
    }

    // --- Loading ---
    function setLoading(loading) {
        if (loading) {
            loadingOverlay.classList.remove('hidden');
        } else {
            loadingOverlay.classList.add('hidden');
        }
    }

    // --- Authentication ---
    window.handleCredentialResponse = async (response) => {
        setLoading(true);
        const idToken = response.credential;
        const credential = GoogleAuthProvider.credential(idToken);
        try {
            await signInWithCredential(auth, credential);
            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } catch (e) { 
            console.error(e);
            let errorMessage = 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
            if (e.code === 'auth/account-exists-with-different-credential') {
                errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø±ØªØ¨Ø· Ø¨Ø·Ø±ÙŠÙ‚Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø£Ø®Ø±Ù‰.';
            } else if (e.code === 'auth/invalid-credential') {
                errorMessage = 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­Ø©.';
            }
            showToast(errorMessage, 'error');
        } finally {
            setLoading(false);
        }
    };

    window.logout = () => {
        setLoading(true);
        signOut(auth).then(() => {
            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'info');
            window.location.reload();
        }).finally(() => setLoading(false));
    };

    // --- Check Profile on Auth Change ---
    onAuthStateChanged(auth, async (user) => {
        setLoading(true);
        currentUser = user;
        
        if (user) {
            const profileRef = doc(db, 'users', user.uid);
            const snap = await getDoc(profileRef);
            
            if (snap.exists()) {
                currentUserProfile = snap.data();
                isProfileComplete = true;
                joiningGateway.classList.add('hidden');
                profileLink.classList.remove('hidden');
                // Load profile data into profile page
                document.getElementById('profileName').value = user.displayName || '';
                document.getElementById('profileEmail').value = user.email || '';
                document.getElementById('profileGrade').value = currentUserProfile.grade || '1';
                document.getElementById('profilePhone').value = currentUserProfile.phone || '';
                document.getElementById('profileSource').value = currentUserProfile.source || 'facebook';
            } else {
                currentUserProfile = null;
                isProfileComplete = false;
                profileLink.classList.add('hidden');
                if (user.email !== ADMIN_EMAIL) {
                    joiningGateway.classList.remove('hidden');
                } else {
                    joiningGateway.classList.add('hidden');
                }
            }
            
            if (user.email === ADMIN_EMAIL) {
                adminLink.classList.remove('hidden');
            } else {
                adminLink.classList.add('hidden');
            }
        } else {
            currentUserProfile = null;
            isProfileComplete = false;
            joiningGateway.classList.add('hidden');
            adminLink.classList.add('hidden');
            profileLink.classList.add('hidden');
        }
        
        updateAuthUI(user);
        fetchData(); // Start listeners
        setLoading(false);
    });

    // --- Update Profile Form (Joining Gateway) ---
    document.getElementById('profileForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentUser) return;
        
        setLoading(true);
        const profile = {
            grade: document.getElementById('userGrade').value,
            phone: document.getElementById('userPhone').value,
            source: document.getElementById('discoverySource').value,
            createdAt: serverTimestamp(),
            email: currentUser.email,
            displayName: currentUser.displayName,
            photoURL: currentUser.photoURL
        };
        
        try {
            await setDoc(doc(db, 'users', currentUser.uid), profile);
            currentUserProfile = profile;
            isProfileComplete = true;
            joiningGateway.classList.add('hidden');
            profileLink.classList.remove('hidden');
            showToast('Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„ÙØ±Ø¹ÙˆÙ†!', 'success');
        } catch (error) {
            console.error(error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        } finally {
            setLoading(false);
        }
    });

    // --- Update Profile Page Form ---
    document.getElementById('updateProfileForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentUser) return;
        
        setLoading(true);
        const updatedProfile = {
            grade: document.getElementById('profileGrade').value,
            phone: document.getElementById('profilePhone').value,
            source: document.getElementById('profileSource').value,
            updatedAt: serverTimestamp()
        };
        
        try {
            await updateDoc(doc(db, 'users', currentUser.uid), updatedProfile);
            currentUserProfile = { ...currentUserProfile, ...updatedProfile };
            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } catch (error) {
            console.error(error);
            showToast('ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'error');
        } finally {
            setLoading(false);
        }
    });

    // --- Render Auth Section ---
    function updateAuthUI(user) {
        if (user) {
            authSection.innerHTML = `
                <div class="flex items-center gap-3 bg-white/90 p-2 pr-5 rounded-full border shadow-md border-blue-100">
                    <div class="text-right hidden sm:block">
                        <div class="text-xs font-black text-gray-900">${user.displayName || 'Ø·Ø§Ù„Ø¨'}</div>
                        <div class="text-[10px] text-blue-600 font-bold">${user.email === ADMIN_EMAIL ? 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…' : 'Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ù†ØµØ©'}</div>
                    </div>
                    <img src="${user.photoURL || 'https://ui-avatars.com/api/?name='+encodeURIComponent(user.displayName||'User')}" class="w-10 h-10 rounded-full border-2 border-blue-200">
                    <button onclick="logout()" class="p-2 text-red-500 hover:bg-red-50 rounded-full transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    </button>
                </div>`;
        } else {
            authSection.innerHTML = `<div id="google-btn-container"></div>`;
            // Render Google button with retry
            const attemptRender = () => {
                if (window.google && google.accounts) {
                    google.accounts.id.renderButton(
                        document.getElementById("google-btn-container"),
                        { theme: "outline", size: "large", shape: "pill", locale: "ar", text: "signin_with", logo_alignment: "center" }
                    );
                } else {
                    setTimeout(attemptRender, 200);
                }
            };
            attemptRender();
        }
    }

    // --- Navigation ---
    window.showPage = (pageId) => {
        document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
        document.getElementById(`page-${pageId}`).classList.remove('hidden');
        
        // Update nav active class
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active-nav', 'text-blue-600', 'font-black');
        });
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // --- Admin Tabs ---
    window.showAdminTab = (tab) => {
        document.querySelectorAll('.admin-tab-content').forEach(t => t.classList.add('hidden'));
        document.querySelectorAll('.admin-tab-btn').forEach(btn => {
            btn.classList.remove('bg-blue-600', 'text-white');
            btn.classList.add('bg-gray-100', 'text-gray-700');
        });
        
        if (tab === 'courses') {
            document.getElementById('adminCoursesTab').classList.remove('hidden');
            document.querySelector('.admin-tab-btn[onclick="showAdminTab(\'courses\')"]').classList.add('bg-blue-600', 'text-white');
        } else if (tab === 'books') {
            document.getElementById('adminBooksTab').classList.remove('hidden');
            document.querySelector('.admin-tab-btn[onclick="showAdminTab(\'books\')"]').classList.add('bg-blue-600', 'text-white');
        } else if (tab === 'announcements') {
            document.getElementById('adminAnnouncementsTab').classList.remove('hidden');
            document.querySelector('.admin-tab-btn[onclick="showAdminTab(\'announcements\')"]').classList.add('bg-blue-600', 'text-white');
        } else if (tab === 'requests') {
            document.getElementById('adminRequestsTab').classList.remove('hidden');
            document.querySelector('.admin-tab-btn[onclick="showAdminTab(\'requests\')"]').classList.add('bg-blue-600', 'text-white');
        }
    };

    // --- File Upload ---
    async function uploadFile(file, path) {
        const storageRef = ref(storage, path);
        await uploadBytes(storageRef, file);
        return await getDownloadURL(storageRef);
    }

    // --- Admin: Add Course ---
    document.getElementById('courseForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentUser || currentUser.email !== ADMIN_EMAIL) return;

        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerHTML = `<div class="flex items-center justify-center gap-2"><div class="loader w-5 h-5 border-white"></div><span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...</span></div>`;

        try {
            const imgFile = document.getElementById('courseImageFile').files[0];
            const videoFile = document.getElementById('courseVideoFile').files[0];
            
            const timestamp = Date.now();
            const imageUrl = await uploadFile(imgFile, `courses/images/${timestamp}_${imgFile.name}`);
            const videoUrl = await uploadFile(videoFile, `courses/videos/${timestamp}_${videoFile.name}`);

            await addDoc(collection(db, 'courses'), {
                title: document.getElementById('courseTitle').value,
                grade: document.getElementById('courseGrade').value,
                type: document.getElementById('courseType').value,
                price: document.getElementById('coursePrice').value,
                imageUrl,
                videoUrl,
                description: document.getElementById('courseDesc').value,
                createdAt: serverTimestamp(),
                createdBy: currentUser.uid
            });
            
            document.getElementById('courseForm').reset();
            showToast('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } catch (e) { 
            console.error(e); 
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹', 'error');
        } finally { 
            btn.disabled = false; 
            btn.innerText = "Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰"; 
        }
    });

    // --- Admin: Add Book ---
    document.getElementById('bookForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentUser || currentUser.email !== ADMIN_EMAIL) return;

        const btn = document.getElementById('submitBookBtn');
        btn.disabled = true;
        btn.innerHTML = `<div class="flex items-center justify-center gap-2"><div class="loader w-5 h-5 border-white"></div><span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...</span></div>`;

        try {
            const pdfFile = document.getElementById('bookFile').files[0];
            const timestamp = Date.now();
            const pdfUrl = await uploadFile(pdfFile, `books/${timestamp}_${pdfFile.name}`);

            await addDoc(collection(db, 'books'), {
                title: document.getElementById('bookTitle').value,
                grade: document.getElementById('bookGrade').value,
                description: document.getElementById('bookDesc').value,
                pdfUrl,
                createdAt: serverTimestamp(),
                createdBy: currentUser.uid
            });
            
            document.getElementById('bookForm').reset();
            showToast('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } catch (e) { 
            console.error(e); 
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹', 'error');
        } finally { 
            btn.disabled = false; 
            btn.innerText = "Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ø²Ù…Ø©"; 
        }
    });

    // --- Admin: Add Announcement ---
    document.getElementById('announcementForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentUser || currentUser.email !== ADMIN_EMAIL) return;

        const btn = document.getElementById('submitAnnouncementBtn');
        btn.disabled = true;
        btn.innerHTML = `<div class="flex items-center justify-center gap-2"><div class="loader w-5 h-5 border-white"></div><span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...</span></div>`;

        try {
            await addDoc(collection(db, 'announcements'), {
                title: document.getElementById('announcementTitle').value,
                content: document.getElementById('announcementContent').value,
                important: document.getElementById('announcementImportant').checked,
                createdAt: serverTimestamp(),
                createdBy: currentUser.uid
            });
            
            document.getElementById('announcementForm').reset();
            showToast('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'success');
        } catch (e) { 
            console.error(e); 
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
        } finally { 
            btn.disabled = false; 
            btn.innerText = "Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†"; 
        }
    });

    // --- Subscription Modal ---
    window.openSubscribeModal = (id, title) => {
        if (!currentUser) {
            showToast('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹', 'info');
            return;
        }
        if (!isProfileComplete && currentUser.email !== ADMIN_EMAIL) {
            showToast('ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹', 'info');
            joiningGateway.classList.remove('hidden');
            return;
        }
        document.getElementById('subCourseId').value = id;
        document.getElementById('subCourseTitle').value = title;
        document.getElementById('subscribe-modal').classList.remove('hidden');
    };

    window.closeSubscribeModal = () => document.getElementById('subscribe-modal').classList.add('hidden');

    document.getElementById('subscribeForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentUser) return;
        
        setLoading(true);
        const subData = {
            courseId: document.getElementById('subCourseId').value,
            courseTitle: document.getElementById('subCourseTitle').value,
            studentName: document.getElementById('subName').value,
            studentWhatsapp: document.getElementById('subWhatsapp').value,
            senderPhone: document.getElementById('subSenderPhone').value,
            studentId: currentUser.uid,
            studentEmail: currentUser.email,
            status: 'pending',
            createdAt: serverTimestamp()
        };
        
        try {
            await addDoc(collection(db, 'subscriptions'), subData);
            
            const msg = encodeURIComponent(`Ø§Ù„Ø£Ø³ØªØ§Ø° Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø±ØŒ Ù‚Ù…Øª Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„ÙƒÙˆØ±Ø³: (${subData.courseTitle})\nØ§Ù„Ø§Ø³Ù…: ${subData.studentName}\nØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡: ${subData.senderPhone}`);
            window.open(`https://wa.me/+201273740256?text=${msg}`, '_blank');
            
            closeSubscribeModal();
            showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡', 'success');
        } catch (error) {
            console.error(error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
        } finally {
            setLoading(false);
        }
    });

    // --- Filter for Courses ---
    window.filterByGrade = (grade) => {
        currentFilterGrade = grade;
        document.querySelectorAll('.grade-btn').forEach(b => {
            b.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
            b.classList.add('bg-white', 'text-gray-700', 'border-gray-200');
        });
        const active = Array.from(document.querySelectorAll('.grade-btn')).find(b => b.innerText.includes(grade == 'all' ? 'Ø§Ù„ÙƒÙ„' : grade == '1' ? 'Ø§Ù„Ø£ÙˆÙ„' : grade == '2' ? 'Ø§Ù„Ø«Ø§Ù†ÙŠ' : 'Ø§Ù„Ø«Ø§Ù„Ø«'));
        if (active) {
            active.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
            active.classList.remove('bg-white', 'text-gray-700', 'border-gray-200');
        }
        renderCourses();
    };

    // --- Fetch Real-time Data ---
    function fetchData() {
        // Courses
        const coursesRef = collection(db, 'courses');
        onSnapshot(query(coursesRef, orderBy('createdAt', 'desc')), (snapshot) => {
            allCourses = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderCourses();
            if (currentUser?.email === ADMIN_EMAIL) {
                renderAdminCourses(allCourses);
            }
        });

        // Books
        const booksRef = collection(db, 'books');
        onSnapshot(query(booksRef, orderBy('createdAt', 'desc')), (snapshot) => {
            allBooks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderBooks();
            if (currentUser?.email === ADMIN_EMAIL) {
                renderAdminBooks(allBooks);
            }
        });

        // Announcements
        const announcementsRef = collection(db, 'announcements');
        onSnapshot(query(announcementsRef, orderBy('important', 'desc'), orderBy('createdAt', 'desc')), (snapshot) => {
            allAnnouncements = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderAnnouncements();
            if (currentUser?.email === ADMIN_EMAIL) {
                renderAdminAnnouncements(allAnnouncements);
            }
        });

        // Subscriptions (if user logged in)
        if (currentUser) {
            const subsRef = collection(db, 'subscriptions');
            onSnapshot(query(subsRef), (snapshot) => {
                mySubscriptions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderCourses(); // Re-render courses to update access status
                if (currentUser.email === ADMIN_EMAIL) {
                    renderAdminRequests(mySubscriptions);
                }
            });
        }
    }

    // --- Render Courses ---
    function renderCourses() {
        const container = document.getElementById('coursesList');
        let filtered = currentFilterGrade === 'all' ? allCourses : allCourses.filter(c => c.grade == currentFilterGrade);
        
        if (!filtered.length) { 
            container.innerHTML = "<div class='col-span-full text-center py-20 text-gray-400 font-bold'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ù†Ø´ÙˆØ±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ØµÙ Ø­Ø§Ù„ÙŠØ§Ù‹.</div>"; 
            return; 
        }
        
        container.innerHTML = filtered.map(c => {
            const isSubscribed = mySubscriptions.some(s => s.courseId === c.id && s.studentId === currentUser?.uid && s.status === 'approved');
            const isPending = mySubscriptions.some(s => s.courseId === c.id && s.studentId === currentUser?.uid && s.status === 'pending');
            const isFree = c.type === 'free';
            const canAccess = isSubscribed || isFree || currentUser?.email === ADMIN_EMAIL;

            return `
                <div class="course-card bg-white rounded-[2.5rem] overflow-hidden border border-gray-100 shadow-sm fade-in">
                    <div class="relative h-56">
                        <img src="${c.imageUrl || 'https://via.placeholder.com/400x200?text=Ù…Ø­Ø§Ø¶Ø±Ø©'}" class="w-full h-full object-cover ${!canAccess ? 'hidden-content' : ''}">
                        <div class="absolute top-4 right-4 bg-gradient-to-l from-blue-700 to-blue-500 text-white text-xs px-4 py-2 rounded-full font-black shadow-lg">
                            Ø§Ù„ØµÙ ${c.grade == '1' ? 'Ø§Ù„Ø£ÙˆÙ„' : c.grade == '2' ? 'Ø§Ù„Ø«Ø§Ù†ÙŠ' : 'Ø§Ù„Ø«Ø§Ù„Ø«'}
                        </div>
                        ${!canAccess ? `
                            <div class="absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-[2px]">
                                <span class="bg-white/90 p-4 rounded-full shadow-xl text-2xl">ğŸ”’</span>
                            </div>
                        ` : ''}
                    </div>
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-black text-xl text-gray-800">${c.title}</h3>
                            <span class="text-blue-600 font-black bg-blue-50 px-3 py-1 rounded-full">${isFree ? 'Ù…Ø¬Ø§Ù†Ø§Ù‹' : c.price + ' Ø¬.Ù…'}</span>
                        </div>
                        <p class="text-gray-500 text-sm mb-6 line-clamp-2">${c.description || ''}</p>
                        
                        ${canAccess ? `
                            <div class="space-y-4">
                                <video controls class="w-full rounded-2xl bg-black h-44 shadow-inner">
                                    <source src="${c.videoUrl}" type="video/mp4">
                                </video>
                                <button class="w-full py-4 bg-blue-50 text-blue-700 font-black rounded-2xl hover:bg-blue-100 transition">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</button>
                            </div>
                        ` : `
                            <div class="bg-gray-50 p-6 rounded-2xl text-center border-2 border-dashed border-gray-200">
                                <p class="text-sm font-bold text-gray-600 mb-4">${isPending ? 'Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©...' : 'Ø§Ø´ØªØ±Ùƒ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ÙƒØ§Ù…Ù„Ø§Ù‹'}</p>
                                ${isPending ? 
                                    `<div class="loader w-6 h-6 border-blue-600 mx-auto"></div>` : 
                                    `<button onclick="openSubscribeModal('${c.id}', '${c.title}')" class="w-full py-4 bg-gradient-to-l from-blue-600 to-blue-500 text-white font-black rounded-2xl shadow-xl shadow-blue-100 hover:shadow-2xl transition">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø¢Ù†</button>`}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }).join('');
    }

    // --- Render Books ---
    function renderBooks() {
        const container = document.getElementById('booksList');
        if (!allBooks.length) { 
            container.innerHTML = "<div class='col-span-full text-center py-20 text-gray-400 font-bold'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø²Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</div>"; 
            return; 
        }
        
        container.innerHTML = allBooks.map(book => `
            <div class="book-card bg-white rounded-[2.5rem] overflow-hidden border border-gray-100 shadow-sm p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-16 h-16 bg-gradient-to-br from-green-100 to-green-50 rounded-2xl flex items-center justify-center text-3xl">ğŸ“˜</div>
                    <div>
                        <h3 class="font-black text-xl text-gray-800">${book.title}</h3>
                        <span class="text-xs text-gray-500">Ø§Ù„ØµÙ ${book.grade == '1' ? 'Ø§Ù„Ø£ÙˆÙ„' : book.grade == '2' ? 'Ø§Ù„Ø«Ø§Ù†ÙŠ' : 'Ø§Ù„Ø«Ø§Ù„Ø«'} Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</span>
                    </div>
                </div>
                <p class="text-gray-500 text-sm mb-4 line-clamp-2">${book.description || ''}</p>
                <a href="${book.pdfUrl}" target="_blank" class="block w-full py-3 bg-gradient-to-l from-green-600 to-green-500 text-white text-center rounded-2xl font-black shadow-lg hover:shadow-xl transition">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø²Ù…Ø©</a>
            </div>
        `).join('');
    }

    // --- Render Announcements ---
    function renderAnnouncements() {
        const container = document.getElementById('announcementsList');
        if (!allAnnouncements.length) { 
            container.innerHTML = "<div class='col-span-full text-center py-20 text-gray-400 font-bold'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>"; 
            return; 
        }
        
        container.innerHTML = allAnnouncements.map(ann => `
            <div class="announcement-card bg-white rounded-[2.5rem] border border-gray-100 shadow-sm p-8 ${ann.important ? 'border-r-8 border-yellow-500' : ''}">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-yellow-100 to-yellow-50 rounded-2xl flex items-center justify-center text-2xl">ğŸ“¢</div>
                    <div class="flex-1">
                        <h3 class="font-black text-2xl text-gray-800 mb-2">${ann.title}</h3>
                        <p class="text-gray-600 leading-relaxed">${ann.content}</p>
                        <div class="text-xs text-gray-400 mt-4">${new Date(ann.createdAt?.seconds * 1000).toLocaleDateString('ar-EG')}</div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // --- Admin Render Functions ---
    function renderAdminCourses(courses) {
        const container = document.getElementById('adminCoursesList');
        if (!container) return;
        container.innerHTML = courses.map(c => `
            <div class="flex items-center justify-between p-5 bg-white rounded-3xl border border-gray-100 shadow-sm">
                <div class="flex items-center gap-4">
                    <img src="${c.imageUrl || 'https://via.placeholder.com/56'}" class="w-14 h-14 rounded-2xl object-cover shadow-sm">
                    <div>
                        <div class="font-black text-gray-800">${c.title}</div>
                        <div class="text-[10px] text-gray-400 font-bold uppercase">ØµÙ: ${c.grade} â€¢ ${c.type === 'paid' ? 'Ù…Ø¯ÙÙˆØ¹' : 'Ù…Ø¬Ø§Ù†ÙŠ'}</div>
                    </div>
                </div>
                <button onclick="deleteCourse('${c.id}')" class="p-3 text-red-500 hover:bg-red-50 rounded-2xl transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </button>
            </div>
        `).join('');
    }

    function renderAdminBooks(books) {
        const container = document.getElementById('adminBooksList');
        if (!container) return;
        container.innerHTML = books.map(b => `
            <div class="flex items-center justify-between p-5 bg-white rounded-3xl border border-gray-100 shadow-sm">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-green-100 rounded-2xl flex items-center justify-center text-2xl">ğŸ“˜</div>
                    <div>
                        <div class="font-black text-gray-800">${b.title}</div>
                        <div class="text-[10px] text-gray-400 font-bold">Ø§Ù„ØµÙ: ${b.grade}</div>
                    </div>
                </div>
                <button onclick="deleteBook('${b.id}')" class="p-3 text-red-500 hover:bg-red-50 rounded-2xl transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </button>
            </div>
        `).join('');
    }

    function renderAdminAnnouncements(announcements) {
        const container = document.getElementById('adminAnnouncementsList');
        if (!container) return;
        container.innerHTML = announcements.map(a => `
            <div class="flex items-center justify-between p-5 bg-white rounded-3xl border border-gray-100 shadow-sm">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-yellow-100 rounded-2xl flex items-center justify-center text-2xl">ğŸ“¢</div>
                    <div>
                        <div class="font-black text-gray-800">${a.title}</div>
                        <div class="text-[10px] text-gray-400 font-bold">${a.important ? 'â­ Ù…Ù‡Ù…' : 'Ø¹Ø§Ø¯ÙŠ'}</div>
                    </div>
                </div>
                <button onclick="deleteAnnouncement('${a.id}')" class="p-3 text-red-500 hover:bg-red-50 rounded-2xl transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </button>
            </div>
        `).join('');
    }

    function renderAdminRequests(reqs) {
        const container = document.getElementById('subRequestsList');
        const pendings = reqs.filter(r => r.status === 'pending');
        if (!pendings.length) { 
            container.innerHTML = "<p class='text-center text-gray-400 py-10'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>"; 
            return; 
        }
        
        container.innerHTML = pendings.map(r => `
            <div class="p-6 bg-blue-50/50 border border-blue-100 rounded-[2rem] flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-sm">
                    <div class="font-black text-blue-900 text-lg mb-1">${r.studentName}</div>
                    <div class="text-gray-600 mb-1">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©: <span class="font-black text-gray-800">${r.courseTitle}</span></div>
                    <div class="flex gap-4 text-[11px] font-bold text-blue-600">
                        <span>ğŸ“± ${r.studentWhatsapp}</span>
                        <span>ğŸ’¸ Ù…Ù†: ${r.senderPhone}</span>
                    </div>
                </div>
                <div class="flex gap-2 w-full md:w-auto">
                    <button onclick="approveSub('${r.id}')" class="flex-1 md:flex-none bg-blue-600 text-white px-6 py-3 rounded-2xl text-xs font-black shadow-lg">ØªÙØ¹ÙŠÙ„</button>
                    <button onclick="deleteSub('${r.id}')" class="flex-1 md:flex-none bg-white text-red-500 border border-red-100 px-6 py-3 rounded-2xl text-xs font-black">Ø±ÙØ¶</button>
                </div>
            </div>
        `).join('');
    }

    // --- Admin Actions ---
    window.approveSub = async (id) => {
        if (!confirm("ØªØ£ÙƒÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ù„Ù„Ø·Ø§Ù„Ø¨ØŸ")) return;
        setLoading(true);
        try {
            await updateDoc(doc(db, 'subscriptions', id), { status: 'approved' });
            showToast('ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } catch (error) {
            console.error(error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
        } finally {
            setLoading(false);
        }
    };

    window.deleteSub = async (id) => {
        if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ")) return;
        setLoading(true);
        try {
            await deleteDoc(doc(db, 'subscriptions', id));
            showToast('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨', 'info');
        } catch (error) {
            console.error(error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
        } finally {
            setLoading(false);
        }
    };

    window.deleteCourse = async (id) => {
        if (!confirm("Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ù†ØµØ©ØŒ Ù‡Ù„ ØªÙˆØ§ÙÙ‚ØŸ")) return;
        setLoading(true);
        try {
            await deleteDoc(doc(db, 'courses', id));
            showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
        } catch (error) {
            console.error(error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
        } finally {
            setLoading(false);
        }
    };

    window.deleteBook = async (id) => {
        if (!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø²Ù…Ø©ØŸ")) return;
        setLoading(true);
        try {
            await deleteDoc(doc(db, 'books', id));
            showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
        } catch (error) {
            console.error(error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
        } finally {
            setLoading(false);
        }
    };

    window.deleteAnnouncement = async (id) => {
        if (!confirm("Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ")) return;
        setLoading(true);
        try {
            await deleteDoc(doc(db, 'announcements', id));
            showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
        } catch (error) {
            console.error(error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
        } finally {
            setLoading(false);
        }
    };

    // Make functions global for onclick
    window.approveSub = approveSub;
    window.deleteSub = deleteSub;
    window.deleteCourse = deleteCourse;
    window.deleteBook = deleteBook;
    window.deleteAnnouncement = deleteAnnouncement;

</script>

</body>
</html>
