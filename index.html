<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø£Ø³ØªØ§Ø° Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø± | Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <!-- Tailwind + Fonts + Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Firebase Firestore ÙÙ‚Ø· -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, addDoc, updateDoc, deleteDoc, orderBy } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyCoG63qojGugIkvc7-T0M7BnP4KRMQuyrE",
            authDomain: "mr-jabr.firebaseapp.com",
            projectId: "mr-jabr",
            storageBucket: "mr-jabr.firebasestorage.app",
            messagingSenderId: "563345828466",
            appId: "1:563345828466:web:f0bdd40711c935f60d30eb",
            measurementId: "G-C7L0T2QHL8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.db = db;
        window.collection = collection;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.getDocs = getDocs;
        window.addDoc = addDoc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.query = query;
        window.where = where;
        window.orderBy = orderBy;
    </script>
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f9fafb; }
        .glass { background: rgba(255,255,255,0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .course-card { transition: all 0.3s ease; }
        .course-card:hover { transform: translateY(-5px); box-shadow: 0 20px 30px -10px rgba(0,0,0,0.15); }
        .admin-tab { @apply px-6 py-3 font-bold rounded-full transition-all; }
        .admin-tab.active { @apply bg-blue-600 text-white; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
        @keyframes float { 0% { transform: translateY(0); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0); } }
        .float-anim { animation: float 6s infinite; }
    </style>
</head>
<body class="text-gray-800 overflow-x-hidden">

    <!-- ========== HEADER ========== -->
    <header id="mainHeader" class="fixed top-0 w-full z-50 transition-all duration-300 h-20 flex items-center bg-white/90 backdrop-blur-md shadow-sm">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="#" onclick="navigate('hi'); return false;" class="flex items-center gap-2">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-graduation-cap text-white"></i>
                </div>
                <span class="font-black text-xl text-blue-900 hidden sm:block">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù….Ø¬Ø§Ø¨Ø±</span>
            </a>
            <nav class="hidden md:flex items-center gap-6 font-semibold">
                <a href="#" onclick="navigate('hi')" class="nav-link hover:text-blue-600 transition">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="#" onclick="navigate('home')" class="nav-link hover:text-blue-600 transition">Ù„ÙˆØ­ØªÙŠ</a>
                <a href="#" onclick="navigate('courses')" class="nav-link hover:text-blue-600 transition">Ø§Ù„Ø¯ÙˆØ±Ø§Øª</a>
                <a href="#" onclick="navigate('settings')" class="nav-link hover:text-blue-600 transition">Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙŠ</a>
                <a href="#" onclick="navigate('admin')" class="nav-link admin-only hidden hover:text-blue-600 transition">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
            </nav>
            <div class="flex items-center gap-3">
                <!-- User info -->
                <div id="userProfile" class="hidden items-center gap-2 bg-gray-100 px-3 py-1.5 rounded-full">
                    <img id="userAvatar" src="" class="w-8 h-8 rounded-full border-2 border-blue-300">
                    <span id="userName" class="font-bold text-sm"></span>
                    <button onclick="logout()" class="text-red-500 text-xs mr-2"><i class="fas fa-sign-out-alt"></i></button>
                </div>
                <div id="authButtons" class="flex items-center gap-2">
                    <button onclick="openLoginModal()" class="px-5 py-2 rounded-full border-2 border-blue-600 text-blue-600 font-bold hover:bg-blue-600 hover:text-white transition">Ø¯Ø®ÙˆÙ„</button>
                    <button onclick="openLoginModal()" class="px-5 py-2 rounded-full bg-blue-600 text-white font-bold shadow-lg">Ø§Ø¨Ø¯Ø£</button>
                </div>
                <button id="menuToggle" onclick="toggleMobileMenu()" class="md:hidden p-2 rounded-lg bg-gray-100"><i class="fas fa-bars"></i></button>
            </div>
        </div>
    </header>

    <!-- Mobile menu overlay -->
    <div id="mobileMenu" class="fixed inset-0 bg-white z-[60] hidden flex-col items-center justify-center gap-6 text-2xl font-bold">
        <button onclick="toggleMobileMenu()" class="absolute top-6 right-6 text-3xl">&times;</button>
        <a href="#" onclick="navigate('hi'); toggleMobileMenu()">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="#" onclick="navigate('home'); toggleMobileMenu()">Ù„ÙˆØ­ØªÙŠ</a>
        <a href="#" onclick="navigate('courses'); toggleMobileMenu()">Ø§Ù„Ø¯ÙˆØ±Ø§Øª</a>
        <a href="#" onclick="navigate('settings'); toggleMobileMenu()">Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙŠ</a>
        <a href="#" onclick="navigate('admin'); toggleMobileMenu()" class="admin-only hidden">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    </div>

    <!-- Login Modal (Google) -->
    <div id="loginModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-md w-full p-8 relative">
            <button onclick="closeLoginModal()" class="absolute top-4 left-4 text-3xl text-gray-400">&times;</button>
            <div class="text-center">
                <i class="fas fa-user-graduate text-5xl text-blue-600 mb-4"></i>
                <h3 class="text-2xl font-black mb-2">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
                <p class="text-gray-500 mb-6">Ø§Ø³ØªØ®Ø¯Ù… Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
                <div id="googleSignInBtn" class="flex justify-center"></div>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©) -->
    <div id="additionalInfoModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[110] hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-md w-full p-8 relative">
            <h3 class="text-2xl font-black mb-6">Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</h3>
            <div class="space-y-4">
                <select id="inputGrade" class="w-full p-3 border rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</option>
                    <option value="first">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                    <option value="second">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                    <option value="third">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                </select>
                <input type="text" id="inputPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ø«Ø§Ù„: 01012345678)" class="w-full p-3 border rounded-xl">
                <input type="text" id="inputHowHeard" placeholder="ÙƒÙŠÙ Ø³Ù…Ø¹Øª Ø¹Ù†Ø§ØŸ (ØµØ¯ÙŠÙ‚ØŒ ÙÙŠØ³Ø¨ÙˆÙƒØŒ ...)" class="w-full p-3 border rounded-xl">
                <button onclick="saveAdditionalInfo()" class="w-full bg-blue-600 text-white p-3 rounded-xl font-bold">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- ========== Ø§Ù„ØµÙØ­Ø§Øª ========== -->
    <main class="pt-24 min-h-screen">
        <!-- ØµÙØ­Ø© hi (Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© + Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª) -->
        <section id="page-hi" class="page active">
            <div class="hero-gradient bg-gradient-to-l from-blue-900 to-blue-600 text-white py-20 relative overflow-hidden">
                <div class="container mx-auto px-4 grid md:grid-cols-2 gap-10 items-center">
                    <div class="space-y-6">
                        <h1 class="text-5xl md:text-6xl font-black leading-tight">Ø£ØªÙ‚Ù† Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© <br> <span class="text-yellow-300">Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø¹ØµØ±ÙŠ</span></h1>
                        <p class="text-xl opacity-90">Ù…Ø¹ Ø§Ù„Ø£Ø³ØªØ§Ø° Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø±ØŒ Ù†Ù‚Ø¯Ù… Ù„Ùƒ ØªØ¬Ø±Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙØ±ÙŠØ¯Ø© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø£ØµØ§Ù„Ø© ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§.</p>
                        <button onclick="navigate('courses')" class="bg-white text-blue-700 font-bold px-8 py-4 rounded-2xl shadow-xl hover:scale-105 transition">ØªØµÙØ­ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</button>
                    </div>
                    <div class="flex justify-center">
                        <img src="https://placehold.co/600x400/1e3a8a/white?text=Mohamed+Jaber" class="rounded-3xl shadow-2xl float-anim">
                    </div>
                </div>
            </div>
            <!-- 10 Ù…ÙŠØ²Ø§Øª -->
            <div class="py-20 bg-white">
                <div class="container mx-auto px-4">
                    <h2 class="text-4xl font-black text-center mb-16">Ù„Ù…Ø§Ø°Ø§ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØªÙ†Ø§ØŸ <span class="text-blue-600">10 Ù…ÙŠØ²Ø§Øª Ø­ØµØ±ÙŠØ©</span></h2>
                    <div class="grid md:grid-cols-5 gap-6">
                        <div class="p-4 text-center"><i class="fas fa-video text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">Ø¯Ø±ÙˆØ³ 4K</h4></div>
                        <div class="p-4 text-center"><i class="fas fa-file-pdf text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">Ù…Ø°ÙƒØ±Ø§Øª PDF</h4></div>
                        <div class="p-4 text-center"><i class="fas fa-tasks text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ©</h4></div>
                        <div class="p-4 text-center"><i class="fas fa-certificate text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù…</h4></div>
                        <div class="p-4 text-center"><i class="fas fa-comments text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h4></div>
                        <div class="p-4 text-center"><i class="fas fa-chart-line text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">ØªØªØ¨Ø¹ Ø§Ù„ØªÙ‚Ø¯Ù…</h4></div>
                        <div class="p-4 text-center"><i class="fas fa-wallet text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø·</h4></div>
                        <div class="p-4 text-center"><i class="fas fa-search text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…</h4></div>
                        <div class="p-4 text-center"><i class="fas fa-share-alt text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</h4></div>
                        <div class="p-4 text-center"><i class="fas fa-gem text-3xl text-blue-600 mb-3"></i><h4 class="font-bold">Ù…ØªØ¬Ø± ØªØ¹Ù„ÙŠÙ…ÙŠ</h4></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ØµÙØ­Ø© home (Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) -->
        <section id="page-home" class="page hidden">
            <div class="container mx-auto px-4 py-10">
                <h2 class="text-4xl font-black mb-4">Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="welcomeName"></span> ğŸ‘‹</h2>
                <div class="grid md:grid-cols-4 gap-4 mb-10">
                    <div class="bg-white p-6 rounded-2xl shadow-md">
                        <i class="fas fa-book-open text-blue-600 text-3xl mb-2"></i>
                        <h3 class="font-bold text-xl">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¨Ù‡Ø§</h3>
                        <p class="text-3xl font-black" id="enrolledCount">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-md">
                        <i class="fas fa-video text-blue-600 text-3xl mb-2"></i>
                        <h3 class="font-bold text-xl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</h3>
                        <p class="text-3xl font-black" id="watchedCount">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-md">
                        <i class="fas fa-star text-blue-600 text-3xl mb-2"></i>
                        <h3 class="font-bold text-xl">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                        <p class="text-3xl font-black" id="rating">4.8</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-md">
                        <i class="fas fa-gem text-blue-600 text-3xl mb-2"></i>
                        <h3 class="font-bold text-xl">Ù†Ù‚Ø§Ø·ÙŠ</h3>
                        <p class="text-3xl font-black" id="points">150</p>
                    </div>
                </div>

                <h3 class="text-2xl font-bold mb-4">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ùƒ (Ø­Ø³Ø¨ ØµÙÙƒ)</h3>
                <div id="recommendedCourses" class="grid md:grid-cols-3 gap-6"></div>
            </div>
        </section>

        <!-- ØµÙØ­Ø© Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª -->
        <section id="page-courses" class="page hidden">
            <div class="container mx-auto px-4 py-10">
                <h2 class="text-4xl font-black mb-4">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</h2>
                <div class="flex gap-2 mb-8">
                    <button onclick="filterCourses('all')" class="filter-btn active px-6 py-2 bg-blue-600 text-white rounded-full font-bold">Ø§Ù„ÙƒÙ„</button>
                    <button onclick="filterCourses('first')" class="filter-btn px-6 py-2 bg-gray-200 rounded-full font-bold hover:bg-gray-300">Ø§Ù„Ø£ÙˆÙ„</button>
                    <button onclick="filterCourses('second')" class="filter-btn px-6 py-2 bg-gray-200 rounded-full font-bold hover:bg-gray-300">Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
                    <button onclick="filterCourses('third')" class="filter-btn px-6 py-2 bg-gray-200 rounded-full font-bold hover:bg-gray-300">Ø§Ù„Ø«Ø§Ù„Ø«</button>
                </div>
                <div id="coursesContainer" class="grid md:grid-cols-3 gap-8"></div>
            </div>
        </section>

        <!-- ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒÙˆØ±Ø³ -->
        <section id="page-course-detail" class="page hidden">
            <div class="container mx-auto px-4 py-10">
                <button onclick="navigate('courses')" class="mb-6 text-blue-600 font-bold"><i class="fas fa-arrow-right ml-2"></i>Ø¹ÙˆØ¯Ø©</button>
                <div id="courseDetailContainer"></div>
            </div>
        </section>

        <!-- ØµÙØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ -->
        <section id="page-settings" class="page hidden">
            <div class="container mx-auto px-4 py-10">
                <h2 class="text-4xl font-black mb-8">Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙŠ</h2>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="col-span-2">
                        <div class="bg-white p-6 rounded-3xl shadow-md">
                            <h3 class="text-2xl font-bold mb-4">Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙŠ</h3>
                            <div id="userSubscriptions" class="space-y-4"></div>
                        </div>
                    </div>
                    <div>
                        <div class="bg-white p-6 rounded-3xl shadow-md">
                            <h3 class="text-2xl font-bold mb-4">Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</h3>
                            <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="profileName"></span></p>
                            <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> <span id="profileEmail"></span></p>
                            <p><strong>Ø§Ù„ØµÙ:</strong> <span id="profileGrade"></span></p>
                            <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> <span id="profilePhone"></span></p>
                            <p><strong>ÙƒÙŠÙ Ø³Ù…Ø¹Øª Ø¹Ù†Ø§:</strong> <span id="profileHowHeard"></span></p>
                            <p class="text-sm text-gray-500 mt-2">Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ.</p>
                            <button onclick="logout()" class="mt-4 text-red-500">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ØµÙØ­Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·) -->
        <section id="page-admin" class="page hidden">
            <div class="container mx-auto px-4 py-10">
                <h2 class="text-4xl font-black mb-8">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                <div class="flex gap-2 mb-8 flex-wrap">
                    <button onclick="adminTab('courses')" class="admin-tab active" id="tabCourses">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</button>
                    <button onclick="adminTab('requests')" class="admin-tab" id="tabRequests">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„</button>
                    <button onclick="adminTab('users')" class="admin-tab" id="tabUsers">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                    <button onclick="adminTab('subscriptions')" class="admin-tab" id="tabSubs">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</button>
                </div>
                <div id="adminContent"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-blue-950 text-white py-12 mt-10">
        <div class="container mx-auto px-4 text-center">
            <p>Â© 2025 Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø£Ø³ØªØ§Ø° Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø± - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
            <p class="text-blue-300 mt-2">ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© <span class="font-bold">Ø¨Ø±Ø§Ø¡ Ø¹Ù…Ø±</span></p>
        </div>
    </footer>

    <script>
        // ================================
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        // ================================
        let currentUser = null;
        let currentUserRole = 'user';
        const adminEmail = 'bo2584668@gmail.com';

        // ================================
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù† localStorage
        // ================================
        (function initSession() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    document.getElementById('authButtons').classList.add('hidden');
                    document.getElementById('userProfile').classList.remove('hidden');
                    document.getElementById('userAvatar').src = currentUser.picture || 'https://placehold.co/40';
                    document.getElementById('userName').innerText = currentUser.name;
                    // Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ± Ù…Ù† Firestore
                    loadUserRole(currentUser.uid).then(() => {
                        // Ø¨Ø¹Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ±ØŒ Ù†Ø­Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
                        const page = getCurrentPage();
                        if (page === 'home' || page === 'settings' || page === 'admin') {
                            navigate(page);
                        } else {
                            navigate('home');
                        }
                    });
                } catch (e) {
                    localStorage.removeItem('currentUser');
                }
            } else {
                // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù†Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ hi
                navigate('hi');
            }
        })();

        // ================================
        // Google Identity Services
        // ================================
        window.onload = function() {
            if (google && google.accounts) {
                google.accounts.id.initialize({
                    client_id: '583210084990-m5j5pkdp63s255aci47grhdhef5rfk9s.apps.googleusercontent.com',
                    callback: handleGoogleCredential,
                    auto_select: false,
                });
                google.accounts.id.renderButton(
                    document.getElementById('googleSignInBtn'),
                    { type: 'standard', theme: 'filled_blue', size: 'large', shape: 'pill', width: 250 }
                );
            }
        };

        async function handleGoogleCredential(response) {
            try {
                const data = parseJwt(response.credential);
                const user = {
                    uid: data.sub,
                    name: data.name,
                    email: data.email,
                    picture: data.picture,
                };
                currentUser = user;

                // Ø­ÙØ¸ ÙÙŠ localStorage
                localStorage.setItem('currentUser', JSON.stringify(user));

                // Ø­ÙØ¸/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firestore
                await saveUserToFirestore(user);
                
                // Ø¬Ù„Ø¨ Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                await loadUserRole(user.uid);
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById('authButtons').classList.add('hidden');
                document.getElementById('userProfile').classList.remove('hidden');
                document.getElementById('userAvatar').src = user.picture || 'https://placehold.co/40';
                document.getElementById('userName').innerText = user.name;

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                const userRef = doc(window.db, 'users', user.uid);
                const userSnap = await getDoc(userRef);
                const userData = userSnap.data();
                if (!userData.grade || !userData.phone || !userData.howHeard) {
                    openAdditionalInfoModal();
                } else {
                    navigate('home');
                }

                closeLoginModal();
            } catch (error) {
                console.error('Login error:', error);
                Swal.fire('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            }
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
            return JSON.parse(jsonPayload);
        }

        async function saveUserToFirestore(user) {
            const userRef = doc(window.db, 'users', user.uid);
            const userSnap = await getDoc(userRef);
            if (!userSnap.exists()) {
                const role = (user.email === adminEmail) ? 'admin' : 'user';
                await setDoc(userRef, {
                    name: user.name,
                    email: user.email,
                    photoURL: user.picture,
                    role: role,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                });
            } else {
                await updateDoc(userRef, { lastLogin: new Date().toISOString() });
            }
        }

        async function loadUserRole(uid) {
            const userRef = doc(window.db, 'users', uid);
            const userSnap = await getDoc(userRef);
            if (userSnap.exists()) {
                currentUserRole = userSnap.data().role || 'user';
            } else {
                currentUserRole = 'user';
            }
            if (currentUserRole === 'admin') {
                document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('hidden'));
            } else {
                document.querySelectorAll('.admin-only').forEach(el => el.classList.add('hidden'));
            }
        }

        // Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
        function openAdditionalInfoModal() {
            document.getElementById('additionalInfoModal').classList.remove('hidden');
        }
        function closeAdditionalInfoModal() {
            document.getElementById('additionalInfoModal').classList.add('hidden');
        }

        window.saveAdditionalInfo = async function() {
            const grade = document.getElementById('inputGrade').value;
            const phone = document.getElementById('inputPhone').value;
            const howHeard = document.getElementById('inputHowHeard').value;
            if (!grade || !phone || !howHeard) {
                Swal.fire('Ø®Ø·Ø£', 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            if (!currentUser) return;
            const userRef = doc(window.db, 'users', currentUser.uid);
            await updateDoc(userRef, { grade, phone, howHeard });
            closeAdditionalInfoModal();
            navigate('home');
        };

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            currentUser = null;
            currentUserRole = 'user';
            localStorage.removeItem('currentUser');
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userProfile').classList.add('hidden');
            document.querySelectorAll('.admin-only').forEach(el => el.classList.add('hidden'));
            if (google && google.accounts) {
                google.accounts.id.disableAutoSelect();
            }
            navigate('hi');
        }

        // ================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ (SPA)
        // ================================
        function navigate(page) {
            // Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ ØªØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
            const protectedPages = ['home', 'settings', 'admin'];
            if (protectedPages.includes(page) && !currentUser) {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ØŒ Ù†Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ hi
                page = 'hi';
            }

            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(`page-${page}`).classList.remove('hidden');
            history.pushState({page}, '', `#${page}`);
            loadPageContent(page);
        }

        function getCurrentPage() {
            return window.location.hash.substring(1) || 'hi';
        }

        window.addEventListener('popstate', (e) => {
            const page = e.state?.page || 'hi';
            navigate(page);
        });

        async function loadPageContent(page) {
            if (page === 'home' && currentUser) {
                loadHomePage();
            } else if (page === 'courses') {
                loadCoursesList();
            } else if (page === 'admin' && currentUserRole === 'admin') {
                adminTab('courses');
            } else if (page === 'settings' && currentUser) {
                loadUserSettings();
            } else if (page === 'course-detail') {
                const courseId = sessionStorage.getItem('currentCourseId');
                if (courseId) loadCourseDetails(courseId);
            }
        }

        // ================================
        // Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (home)
        // ================================
        async function loadHomePage() {
            document.getElementById('welcomeName').innerText = currentUser.name;
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
            document.getElementById('enrolledCount').innerText = '3'; // Ù…Ø¤Ù‚Øª
            document.getElementById('watchedCount').innerText = '27';
            
            // Ø¬Ù„Ø¨ ØµÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firestore
            const userRef = doc(window.db, 'users', currentUser.uid);
            const userSnap = await getDoc(userRef);
            const userGrade = userSnap.exists() ? userSnap.data().grade : null;

            // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ø­Ø³Ø¨ Ø§Ù„ØµÙ
            const container = document.getElementById('recommendedCourses');
            let q = collection(window.db, 'courses');
            if (userGrade) {
                q = query(q, where('grade', '==', userGrade));
            }
            const querySnapshot = await getDocs(q);
            let html = '';
            querySnapshot.forEach(doc => {
                const course = { id: doc.id, ...doc.data() };
                html += `
                    <div class="course-card bg-white rounded-2xl overflow-hidden shadow">
                        <img src="${course.image || 'https://placehold.co/400x200'}" class="w-full h-40 object-cover">
                        <div class="p-4">
                            <h4 class="font-bold text-xl">${course.title}</h4>
                            <p class="text-gray-600 text-sm">${course.description?.substring(0,60)}...</p>
                            <button onclick="viewCourse('${course.id}')" class="mt-2 text-blue-600">Ø¹Ø±Ø¶</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ±Ø³Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø³Ø¨ ØµÙÙƒ Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
        }

        // ================================
        // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª (ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª)
        // ================================
        async function loadCoursesList(grade = 'all') {
            const container = document.getElementById('coursesContainer');
            container.innerHTML = '<div class="col-span-3 text-center py-10">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
            
            let q = collection(window.db, 'courses');
            if (grade !== 'all') {
                q = query(q, where('grade', '==', grade));
            }
            const querySnapshot = await getDocs(q);
            let html = '';
            querySnapshot.forEach(doc => {
                const course = { id: doc.id, ...doc.data() };
                html += `
                    <div class="course-card bg-white rounded-3xl overflow-hidden shadow-lg">
                        <img src="${course.image || 'https://placehold.co/600x400/3b82f6/white?text=Course'}" class="w-full h-48 object-cover">
                        <div class="p-6">
                            <h3 class="text-2xl font-bold mb-2">${course.title}</h3>
                            <p class="text-gray-600 mb-4">${course.description || ''}</p>
                            <div class="flex justify-between items-center">
                                <span class="text-xl font-black text-blue-700">${course.price > 0 ? course.price + ' Ø¬.Ù…' : 'Ù…Ø¬Ø§Ù†ÙŠ'}</span>
                                <button onclick="viewCourse('${course.id}')" class="px-4 py-2 bg-blue-600 text-white rounded-xl">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html || '<div class="col-span-3 text-center py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ±Ø³Ø§Øª</div>';
        }

        window.filterCourses = function(grade) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-blue-600', 'text-white'));
            event.target.classList.add('active', 'bg-blue-600', 'text-white');
            loadCoursesList(grade);
        };

        window.viewCourse = function(courseId) {
            sessionStorage.setItem('currentCourseId', courseId);
            navigate('course-detail');
        };

        async function loadCourseDetails(courseId) {
            const container = document.getElementById('courseDetailContainer');
            container.innerHTML = '<p class="text-center">ØªØ­Ù…ÙŠÙ„...</p>';
            
            const courseRef = doc(window.db, 'courses', courseId);
            const courseSnap = await getDoc(courseRef);
            if (!courseSnap.exists()) return;
            const course = { id: courseSnap.id, ...courseSnap.data() };
            
            let canAccess = false;
            if (course.price === 0) canAccess = true;
            else if (currentUser) {
                const subsQuery = query(collection(window.db, 'subscriptions'), 
                    where('userId', '==', currentUser.uid), 
                    where('courseId', '==', courseId), 
                    where('status', '==', 'active'));
                const subsSnap = await getDocs(subsQuery);
                canAccess = !subsSnap.empty;
            }

            let videosHtml = '';
            if (course.videos && course.videos.length > 0) {
                videosHtml = course.videos.map((video, index) => `
                    <div class="border-b py-4">
                        <h4 class="font-bold mb-2">${index+1}. ${video.title}</h4>
                        ${canAccess ? `<iframe class="w-full h-64 rounded-xl" src="https://www.youtube.com/embed/${video.youtubeId}" frameborder="0" allowfullscreen></iframe>` : '<p class="text-red-500">Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ§Ø­ Ù„Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙÙ‚Ø·</p>'}
                    </div>
                `).join('');
            } else {
                videosHtml = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¨Ø¹Ø¯</p>';
            }

            let subscribeBtn = '';
            if (!canAccess && course.price > 0) {
                if (currentUser) {
                    subscribeBtn = `<button onclick="requestSubscription('${course.id}')" class="px-6 py-3 bg-green-600 text-white rounded-xl font-bold">Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ</button>`;
                } else {
                    subscribeBtn = `<button onclick="openLoginModal()" class="px-6 py-3 bg-blue-600 text-white rounded-xl">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹</button>`;
                }
            }

            container.innerHTML = `
                <h1 class="text-4xl font-black mb-4">${course.title}</h1>
                <p class="text-gray-600 mb-6">${course.description}</p>
                <div class="mb-6">${subscribeBtn}</div>
                <div class="space-y-4">${videosHtml}</div>
            `;
        }

        // ================================
        // Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ
        // ================================
        window.requestSubscription = async function(courseId) {
            if (!currentUser) return openLoginModal();
            
            const { value: formData } = await Swal.fire({
                title: 'Ø·Ù„Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ',
                html:
                    '<input id="swal-name" class="swal2-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" value="' + currentUser.name + '">' +
                    '<input id="swal-whatsapp" class="swal2-input" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø«Ø§Ù„: 01012345678)">' +
                    '<input id="swal-phone" class="swal2-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù„Ù„ØªØ­ÙˆÙŠÙ„)">',
                showCancelButton: true,
                confirmButtonText: 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨',
                preConfirm: () => {
                    const name = document.getElementById('swal-name').value;
                    const whatsapp = document.getElementById('swal-whatsapp').value;
                    const phone = document.getElementById('swal-phone').value;
                    if (!name || !whatsapp || !phone) {
                        Swal.showValidationMessage('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©');
                    }
                    return { name, whatsapp, phone };
                }
            });

            if (formData) {
                const request = {
                    userId: currentUser.uid,
                    userName: formData.name,
                    userWhatsapp: formData.whatsapp,
                    userPhone: formData.phone,
                    courseId: courseId,
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                };
                await addDoc(collection(window.db, 'subscriptionRequests'), request);
                
                Swal.fire({
                    title: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨',
                    html: `ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… <strong>+201273740256</strong> ÙˆØ¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹.<br>Ø±Ù‚Ù…Ùƒ: ${formData.whatsapp}`,
                    icon: 'success'
                });
            }
        };

        // ================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
        // ================================
        async function loadUserSettings() {
            const userRef = doc(window.db, 'users', currentUser.uid);
            const userSnap = await getDoc(userRef);
            if (!userSnap.exists()) return;
            const data = userSnap.data();
            document.getElementById('profileName').innerText = data.name || '';
            document.getElementById('profileEmail').innerText = data.email || '';
            document.getElementById('profileGrade').innerText = data.grade || 'Ù„Ù… ÙŠØ­Ø¯Ø¯';
            document.getElementById('profilePhone').innerText = data.phone || 'Ù„Ù… ÙŠØ­Ø¯Ø¯';
            document.getElementById('profileHowHeard').innerText = data.howHeard || 'Ù„Ù… ÙŠØ­Ø¯Ø¯';

            const subsContainer = document.getElementById('userSubscriptions');
            const q = query(collection(window.db, 'subscriptions'), where('userId', '==', currentUser.uid));
            const subsSnap = await getDocs(q);
            if (subsSnap.empty) {
                subsContainer.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</p>';
                return;
            }
            let html = '';
            for (const docSub of subsSnap.docs) {
                const sub = docSub.data();
                const courseRef = doc(window.db, 'courses', sub.courseId);
                const courseSnap = await getDoc(courseRef);
                const courseTitle = courseSnap.exists() ? courseSnap.data().title : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                html += `
                    <div class="p-4 border rounded-2xl">
                        <p class="font-bold">${courseTitle}</p>
                        <p>Ø§Ù„Ø­Ø§Ù„Ø©: ${sub.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…Ù†ØªÙ‡ÙŠ'}</p>
                        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡: ${new Date(sub.startDate).toLocaleDateString('ar-EG')}</p>
                        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${new Date(sub.endDate).toLocaleDateString('ar-EG')}</p>
                    </div>
                `;
            }
            subsContainer.innerHTML = html;
        }

        // ================================
        // Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†
        // ================================
        window.adminTab = function(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab${tab.charAt(0).toUpperCase()+tab.slice(1)}`).classList.add('active');
            if (tab === 'courses') renderAdminCourses();
            if (tab === 'requests') renderAdminRequests();
            if (tab === 'users') renderAdminUsers();
            if (tab === 'subscriptions') renderAdminSubscriptions();
        };

        async function renderAdminCourses() {
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <div class="mb-4">
                    <button onclick="showAddCourseModal()" class="bg-blue-600 text-white px-6 py-3 rounded-xl">+ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯</button>
                </div>
                <div id="adminCoursesList" class="grid gap-4"></div>
            `;
            const listDiv = document.getElementById('adminCoursesList');
            const q = query(collection(window.db, 'courses'), orderBy('createdAt', 'desc'));
            const snap = await getDocs(q);
            let html = '';
            snap.forEach(doc => {
                const c = doc.data();
                html += `
                    <div class="bg-white p-4 rounded-xl flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-xl">${c.title}</h3>
                            <p>${c.price} Ø¬.Ù… - ${c.grade}</p>
                        </div>
                        <div>
                            <button onclick="editCourse('${doc.id}')" class="text-blue-600 ml-2"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteCourse('${doc.id}')" class="text-red-600"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            });
            listDiv.innerHTML = html || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ±Ø³Ø§Øª</p>';
        }

        window.showAddCourseModal = function() {
            Swal.fire({
                title: 'Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³',
                html: `
                    <input id="course-title" class="swal2-input" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆØ±Ø³">
                    <textarea id="course-desc" class="swal2-input" placeholder="ÙˆØµÙ"></textarea>
                    <input id="course-price" class="swal2-input" placeholder="Ø§Ù„Ø³Ø¹Ø± (0 Ù…Ø¬Ø§Ù†ÙŠ)">
                    <select id="course-grade" class="swal2-input">
                        <option value="first">Ø§Ù„Ø£ÙˆÙ„</option>
                        <option value="second">Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                        <option value="third">Ø§Ù„Ø«Ø§Ù„Ø«</option>
                    </select>
                    <input id="course-image" class="swal2-input" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©">
                `,
                showCancelButton: true,
                confirmButtonText: 'Ø­ÙØ¸',
                preConfirm: async () => {
                    const title = document.getElementById('course-title').value;
                    const desc = document.getElementById('course-desc').value;
                    const price = parseFloat(document.getElementById('course-price').value) || 0;
                    const grade = document.getElementById('course-grade').value;
                    const image = document.getElementById('course-image').value || 'https://placehold.co/600x400/3b82f6/white?text=Course';
                    await addDoc(collection(window.db, 'courses'), {
                        title, description: desc, price, grade, image, 
                        createdAt: new Date().toISOString(), 
                        videos: []
                    });
                    Swal.fire('ØªÙ…', 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ±Ø³', 'success');
                    renderAdminCourses();
                }
            });
        };

        window.deleteCourse = async function(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                await deleteDoc(doc(window.db, 'courses', id));
                renderAdminCourses();
            }
        };

        window.editCourse = function(id) {
            Swal.fire('Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
        };

        // Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„
        async function renderAdminRequests() {
            const content = document.getElementById('adminContent');
            content.innerHTML = '<div id="requestsList"></div>';
            const listDiv = document.getElementById('requestsList');
            const q = query(collection(window.db, 'subscriptionRequests'), where('status', '==', 'pending'));
            const snap = await getDocs(q);
            let html = '';
            snap.forEach(doc => {
                const r = doc.data();
                html += `
                    <div class="bg-white p-4 rounded-xl mb-4">
                        <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${r.userName}</p>
                        <p><strong>ÙˆØ§ØªØ³Ø§Ø¨:</strong> ${r.userWhatsapp}</p>
                        <p><strong>Ù‡Ø§ØªÙ:</strong> ${r.userPhone}</p>
                        <p><strong>Ù…Ø¹Ø±Ù Ø§Ù„ÙƒÙˆØ±Ø³:</strong> ${r.courseId}</p>
                        <button onclick="acceptRequest('${doc.id}', '${r.userId}', '${r.courseId}')" class="px-4 py-2 bg-green-600 text-white rounded-xl ml-2">Ù‚Ø¨ÙˆÙ„</button>
                        <button onclick="rejectRequest('${doc.id}')" class="px-4 py-2 bg-red-600 text-white rounded-xl">Ø±ÙØ¶</button>
                    </div>
                `;
            });
            listDiv.innerHTML = html || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>';
        }

        window.acceptRequest = async function(requestId, userId, courseId) {
            const { value: duration } = await Swal.fire({
                title: 'Ø§Ø®ØªØ± Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ',
                input: 'select',
                inputOptions: {
                    monthly: 'Ø´Ù‡Ø±ÙŠ (30 ÙŠÙˆÙ…)',
                    term: 'ØªØ±Ù… (5 Ø´Ù‡ÙˆØ±)'
                },
                inputPlaceholder: 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø©',
                showCancelButton: true
            });
            if (duration) {
                const startDate = new Date();
                let endDate = new Date();
                if (duration === 'monthly') endDate.setMonth(endDate.getMonth() + 1);
                else endDate.setMonth(endDate.getMonth() + 5);

                await addDoc(collection(window.db, 'subscriptions'), {
                    userId,
                    courseId,
                    startDate: startDate.toISOString(),
                    endDate: endDate.toISOString(),
                    status: 'active',
                    type: duration
                });
                await updateDoc(doc(window.db, 'subscriptionRequests', requestId), { status: 'approved' });
                Swal.fire('ØªÙ…', 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ', 'success');
                renderAdminRequests();
            }
        };

        window.rejectRequest = async function(requestId) {
            await updateDoc(doc(window.db, 'subscriptionRequests', requestId), { status: 'rejected' });
            renderAdminRequests();
        };

        async function renderAdminUsers() {
            const content = document.getElementById('adminContent');
            const usersSnap = await getDocs(collection(window.db, 'users'));
            let html = '<table class="w-full bg-white rounded-xl"><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>';
            usersSnap.forEach(doc => {
                const u = doc.data();
                html += `<tr>
                    <td>${u.name}</td>
                    <td>${u.email}</td>
                    <td>${u.grade || 'â€”'}</td>
                    <td>${u.phone || 'â€”'}</td>
                    <td>${u.role || 'user'}</td>
                    <td>
                        <button onclick="editUserGrade('${doc.id}')" class="text-blue-600">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ</button>
                    </td>
                </tr>`;
            });
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        window.editUserGrade = async function(userId) {
            const { value: newGrade } = await Swal.fire({
                title: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…',
                input: 'select',
                inputOptions: {
                    first: 'Ø§Ù„Ø£ÙˆÙ„',
                    second: 'Ø§Ù„Ø«Ø§Ù†ÙŠ',
                    third: 'Ø§Ù„Ø«Ø§Ù„Ø«'
                },
                showCancelButton: true
            });
            if (newGrade) {
                await updateDoc(doc(window.db, 'users', userId), { grade: newGrade });
                Swal.fire('ØªÙ…', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ', 'success');
                renderAdminUsers();
            }
        };

        async function renderAdminSubscriptions() {
            const content = document.getElementById('adminContent');
            const subsSnap = await getDocs(collection(window.db, 'subscriptions'));
            let html = '<table class="w-full bg-white rounded-xl"><thead><tr><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„ÙƒÙˆØ±Ø³</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>';
            for (const docSub of subsSnap.docs) {
                const sub = docSub.data();
                const userRef = doc(window.db, 'users', sub.userId);
                const userSnap = await getDoc(userRef);
                const userName = userSnap.exists() ? userSnap.data().name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const courseRef = doc(window.db, 'courses', sub.courseId);
                const courseSnap = await getDoc(courseRef);
                const courseTitle = courseSnap.exists() ? courseSnap.data().title : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                html += `<tr>
                    <td>${userName}</td>
                    <td>${courseTitle}</td>
                    <td>${new Date(sub.startDate).toLocaleDateString('ar-EG')}</td>
                    <td>${new Date(sub.endDate).toLocaleDateString('ar-EG')}</td>
                    <td>${sub.status}</td>
                </tr>`;
            }
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // ================================
        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ================================
        window.openLoginModal = () => document.getElementById('loginModal').classList.remove('hidden');
        window.closeLoginModal = () => document.getElementById('loginModal').classList.add('hidden');
        window.toggleMobileMenu = () => document.getElementById('mobileMenu').classList.toggle('hidden');
        window.navigate = navigate;
    </script>
</body>
</html>
