<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أكاديمية الأستاذ محمد جابر التعليمية - اللغة العربية</title>
    
    <!-- External Libraries & Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <script>
        // Advanced Tailwind Configuration
        window.tailwindConfig = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa',
                            500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a'
                        },
                        gold: '#d4af37',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b'
                    },
                    boxShadow: {
                        'premium': '0 10px 40px -10px rgba(0, 0, 0, 0.1)',
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.37)',
                    },
                    borderRadius: {
                        '4xl': '2rem',
                    }
                }
            }
        };
    </script>

    <style>
        /* Modern Design System */
        :root {
            --primary-gradient: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            --glass-bg: rgba(255, 255, 255, 0.8);
            --transition-speed: 0.4s;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f1f5f9;
            color: #334155;
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-mesh {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: 
                radial-gradient(at 0% 0%, rgba(30, 64, 175, 0.05) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(59, 130, 246, 0.05) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(29, 78, 216, 0.05) 0px, transparent 50%),
                radial-gradient(at 0% 100%, rgba(37, 99, 235, 0.05) 0px, transparent 50%);
        }

        /* Glassmorphism Classes */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 1.5rem;
        }

        .nav-link {
            position: relative;
            font-weight: 700;
            transition: var(--transition-speed);
        }

        .nav-link::after {
            content: ''; position: absolute; bottom: -5px; right: 0; width: 0; height: 3px;
            background-color: #1e40af; transition: width 0.3s;
        }

        .nav-link:hover::after, .nav-link.active::after { width: 100%; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Loader */
        #loader {
            position: fixed; inset: 0; background: #fff; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* Dashboard Sidebar Sidebar Animation */
        .sidebar-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        /* Shimmer Effect */
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

        /* Responsive Grid Fixes */
        @media (max-width: 768px) {
            .mobile-hide { display: none !important; }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Screen Mesh -->
    <div class="bg-mesh"></div>

    <!-- Page Loader -->
    <div id="loader">
        <div class="relative w-24 h-24">
            <div class="absolute inset-0 border-4 border-primary-100 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-primary-600 rounded-full border-t-transparent animate-spin"></div>
        </div>
        <p class="mt-4 font-black text-primary-900 animate-pulse">جاري تحميل الأكاديمية...</p>
    </div>

    <!-- Navigation Bar -->
    <header class="fixed top-0 w-full z-[100] transition-all duration-300 h-20" id="main-header">
        <div class="max-w-7xl mx-auto px-4 h-full flex items-center justify-between">
            <!-- Brand -->
            <div class="flex items-center gap-4 cursor-pointer group" onclick="window.router('home')">
                <div class="w-12 h-12 bg-primary-800 rounded-2xl flex items-center justify-center text-white font-black text-2xl shadow-lg transform group-hover:rotate-12 transition-all">م</div>
                <div>
                    <h1 class="text-xl font-black text-primary-900 leading-none">محمد جابر</h1>
                    <span class="text-[11px] font-bold text-gray-500 uppercase tracking-widest">Arabic Masterclass</span>
                </div>
            </div>

            <!-- Desktop Nav -->
            <nav class="hidden lg:flex items-center space-x-reverse space-x-10 text-gray-700">
                <button onclick="window.router('home')" class="nav-link font-bold active">الرئيسية</button>
                <button onclick="window.router('courses')" class="nav-link font-bold">المسارات التعليمية</button>
                <button onclick="window.router('library')" class="nav-link font-bold">المكتبة الرقمية</button>
                <button onclick="window.router('exams')" class="nav-link font-bold">الاختبارات</button>
                <button onclick="window.router('contact')" class="nav-link font-bold">تواصل معنا</button>
            </nav>

            <!-- Auth & Menu -->
            <div class="flex items-center gap-4">
                <div id="google-auth-container" class="flex">
                    <div id="g_id_signin"></div>
                </div>
                
                <div id="user-context" class="hidden flex items-center gap-3 bg-white/50 p-1.5 rounded-full border border-white/50 shadow-sm">
                    <div class="relative group cursor-pointer" onclick="window.router('profile')">
                        <img id="user-avatar" src="" class="w-10 h-10 rounded-full object-cover border-2 border-primary-600">
                        <div class="absolute bottom-0 right-0 w-3 h-3 bg-success rounded-full border-2 border-white"></div>
                    </div>
                    <div class="hidden md:block">
                        <p id="user-display-name" class="text-xs font-black text-gray-800"></p>
                        <p id="user-role-label" class="text-[9px] text-primary-600 font-bold">طالب متميز</p>
                    </div>
                    <button onclick="window.logout()" class="p-2.5 text-red-500 hover:bg-red-50 rounded-full transition" title="تسجيل خروج">
                        <i class="fa-solid fa-power-off"></i>
                    </button>
                </div>

                <button class="lg:hidden p-3 bg-white rounded-xl shadow-sm text-primary-900" onclick="window.toggleMobileMenu()">
                    <i class="fa-solid fa-bars-staggered"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation Drawer -->
    <div id="mobile-drawer" class="fixed inset-0 z-[200] bg-black/60 backdrop-blur-sm hidden flex justify-end">
        <div class="w-72 bg-white h-full shadow-2xl animate__animated animate__slideInLeft">
            <div class="p-6 flex flex-col h-full">
                <div class="flex justify-between items-center mb-10">
                    <span class="font-black text-xl text-primary-900">القائمة</span>
                    <button onclick="window.toggleMobileMenu()" class="text-gray-400 hover:text-black text-2xl"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="flex flex-col gap-6">
                    <button onclick="window.router('home')" class="text-right font-bold text-lg hover:text-primary-600"><i class="fa-solid fa-house ml-3 text-primary-300"></i>الرئيسية</button>
                    <button onclick="window.router('courses')" class="text-right font-bold text-lg hover:text-primary-600"><i class="fa-solid fa-book-open ml-3 text-primary-300"></i>الكورسات</button>
                    <button onclick="window.router('library')" class="text-right font-bold text-lg hover:text-primary-600"><i class="fa-solid fa-file-pdf ml-3 text-primary-300"></i>المكتبة</button>
                    <button onclick="window.router('exams')" class="text-right font-bold text-lg hover:text-primary-600"><i class="fa-solid fa-pen-nib ml-3 text-primary-300"></i>الاختبارات</button>
                    <button onclick="window.router('admin')" id="mobile-admin-btn" class="hidden text-right font-bold text-lg text-red-600"><i class="fa-solid fa-gauge ml-3"></i>لوحة الإدارة</button>
                </div>
                <div class="mt-auto border-t pt-6">
                    <div class="bg-blue-50 p-4 rounded-2xl">
                        <p class="text-[10px] font-bold text-primary-600 mb-2">الدعم الفني</p>
                        <p class="text-xs text-gray-600 leading-relaxed font-bold">تحتاج لمساعدة؟ تواصل معنا عبر واتساب</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="flex-grow pt-24 min-h-screen">
        
        <!-- SECTION: HOME -->
        <section id="section-home" class="view-section py-8">
            <div class="max-w-7xl mx-auto px-4">
                <!-- Hero Banner -->
                <div class="relative overflow-hidden rounded-[3rem] bg-primary-900 text-white p-10 md:p-20 shadow-premium mb-12">
                    <div class="relative z-10 flex flex-col md:flex-row items-center gap-12">
                        <div class="flex-1 text-center md:text-right">
                            <span class="inline-block px-4 py-1.5 bg-white/10 rounded-full text-xs font-bold mb-6 backdrop-blur shadow-sm">أهلاً بك في منصة المستقبل التعليمية</span>
                            <h1 class="text-4xl md:text-7xl font-black mb-8 leading-[1.2]">
                                اصنع مستقبلك بـ <br> <span class="text-gold">لغتك العربية</span>
                            </h1>
                            <p class="text-lg text-primary-100 max-w-xl md:ml-0 mb-10 font-medium leading-relaxed">
                                نجمع بين الأصالة اللغوية وأحدث طرق التعلم الرقمية لنقدم تجربة تعليمية فريدة لكل طالب ثانوية عامة يسعى للقمة.
                            </p>
                            <div class="flex flex-wrap gap-4 justify-center md:justify-start">
                                <button onclick="window.router('courses')" class="px-10 py-5 bg-white text-primary-900 rounded-2xl font-black shadow-lg hover:bg-gold hover:text-white transition-all transform hover:-translate-y-1">تصفح المحاضرات</button>
                                <button onclick="window.router('library')" class="px-10 py-5 bg-primary-700/50 text-white border border-white/20 rounded-2xl font-black backdrop-blur hover:bg-white/10 transition-all">تحميل الملازم</button>
                            </div>
                        </div>
                        <div class="flex-1 relative">
                            <div class="absolute inset-0 bg-gold/20 blur-3xl rounded-full"></div>
                            <img src="https://cdn-icons-png.flaticon.com/512/3429/3429433.png" class="relative z-10 w-full max-w-sm mx-auto animate__animated animate__pulse animate__infinite animate__slow">
                        </div>
                    </div>
                    <!-- Decorative Shapes -->
                    <div class="absolute -top-24 -right-24 w-64 h-64 bg-primary-600/30 rounded-full blur-3xl"></div>
                    <div class="absolute -bottom-24 -left-24 w-64 h-64 bg-gold/10 rounded-full blur-3xl"></div>
                </div>

                <!-- Stats Bar -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-6 mb-20">
                    <div class="glass-card p-8 flex items-center gap-6 shadow-sm border border-white/50 group hover:bg-white transition-all">
                        <div class="w-14 h-14 bg-blue-100 rounded-2xl flex items-center justify-center text-primary-600 text-2xl group-hover:bg-primary-600 group-hover:text-white transition-all"><i class="fa-solid fa-users"></i></div>
                        <div><p class="text-3xl font-black text-gray-800 counter" data-target="15000">0</p><p class="text-xs font-bold text-gray-500">طالب مشترك</p></div>
                    </div>
                    <div class="glass-card p-8 flex items-center gap-6 shadow-sm border border-white/50 group hover:bg-white transition-all">
                        <div class="w-14 h-14 bg-green-100 rounded-2xl flex items-center justify-center text-green-600 text-2xl group-hover:bg-green-600 group-hover:text-white transition-all"><i class="fa-solid fa-video"></i></div>
                        <div><p class="text-3xl font-black text-gray-800 counter" data-target="850">0</p><p class="text-xs font-bold text-gray-500">ساعة شرح</p></div>
                    </div>
                    <div class="glass-card p-8 flex items-center gap-6 shadow-sm border border-white/50 group hover:bg-white transition-all">
                        <div class="w-14 h-14 bg-yellow-100 rounded-2xl flex items-center justify-center text-yellow-600 text-2xl group-hover:bg-yellow-600 group-hover:text-white transition-all"><i class="fa-solid fa-file-invoice"></i></div>
                        <div><p class="text-3xl font-black text-gray-800 counter" data-target="320">0</p><p class="text-xs font-bold text-gray-500">ملزمة PDF</p></div>
                    </div>
                    <div class="glass-card p-8 flex items-center gap-6 shadow-sm border border-white/50 group hover:bg-white transition-all">
                        <div class="w-14 h-14 bg-purple-100 rounded-2xl flex items-center justify-center text-purple-600 text-2xl group-hover:bg-purple-600 group-hover:text-white transition-all"><i class="fa-solid fa-award"></i></div>
                        <div><p class="text-3xl font-black text-gray-800 counter" data-target="98">0</p><p class="text-xs font-bold text-gray-500">نسبة النجاح</p></div>
                    </div>
                </div>

                <!-- Featured Section -->
                <div class="flex justify-between items-end mb-10">
                    <div class="space-y-2">
                        <h2 class="text-3xl font-black text-primary-900">أحدث المحاضرات</h2>
                        <div class="w-20 h-1.5 bg-gold rounded-full"></div>
                    </div>
                    <button onclick="window.router('courses')" class="text-primary-600 font-black hover:underline">عرض الكل <i class="fa-solid fa-chevron-left mr-2"></i></button>
                </div>
                <div id="featured-courses-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Dynamic Content -->
                </div>
            </div>
        </section>

        <!-- SECTION: COURSES -->
        <section id="section-courses" class="view-section hidden py-10">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between gap-8 mb-12">
                    <div class="max-w-lg">
                        <h2 class="text-4xl font-black text-gray-900 mb-4">الدورات والمحاضرات</h2>
                        <p class="text-gray-500 font-bold">اختر الصف الدراسي وتابع محاضراتك بكل سهولة، شرح وافي لكل تفاصيل المنهج.</p>
                    </div>
                    <div class="flex items-center gap-4 bg-white p-2 rounded-2xl shadow-sm h-fit self-end">
                        <button onclick="window.filterCourses('all')" class="filter-btn active px-6 py-2.5 rounded-xl font-bold bg-primary-800 text-white">الكل</button>
                        <button onclick="window.filterCourses('1sec')" class="filter-btn px-6 py-2.5 rounded-xl font-bold text-gray-500 hover:bg-gray-100">الصف الأول</button>
                        <button onclick="window.filterCourses('2sec')" class="filter-btn px-6 py-2.5 rounded-xl font-bold text-gray-500 hover:bg-gray-100">الصف الثاني</button>
                        <button onclick="window.filterCourses('3sec')" class="filter-btn px-6 py-2.5 rounded-xl font-bold text-gray-500 hover:bg-gray-100">الصف الثالث</button>
                    </div>
                </div>
                <div id="courses-full-grid" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                    <!-- Dynamic Content -->
                </div>
            </div>
        </section>

        <!-- SECTION: LIBRARY -->
        <section id="section-library" class="view-section hidden py-10">
            <div class="max-w-7xl mx-auto px-4">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-black text-gray-900 mb-4">المكتبة الرقمية</h2>
                    <p class="text-gray-500 font-bold max-w-2xl mx-auto leading-relaxed">كنز من المعلومات والملازم المنظمة، ابحث عن ملخصك المفضل وقم بتحميله بضغطة واحدة.</p>
                </div>
                
                <div class="grid lg:grid-cols-4 gap-10">
                    <!-- Sidebar Filters -->
                    <aside class="lg:col-span-1 space-y-6">
                        <div class="bg-white p-6 rounded-3xl shadow-premium border border-gray-100">
                            <h3 class="font-black text-lg mb-6 border-b pb-4">تصنيفات المكتبة</h3>
                            <div class="space-y-3">
                                <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 cursor-pointer transition">
                                    <input type="checkbox" checked class="w-5 h-5 accent-primary-600">
                                    <span class="font-bold text-gray-700">ملازم الشرح</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 cursor-pointer transition">
                                    <input type="checkbox" checked class="w-5 h-5 accent-primary-600">
                                    <span class="font-bold text-gray-700">خرائط ذهنية</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 cursor-pointer transition">
                                    <input type="checkbox" checked class="w-5 h-5 accent-primary-600">
                                    <span class="font-bold text-gray-700">بنك الأسئلة</span>
                                </label>
                            </div>
                        </div>
                        <div class="bg-primary-900 p-8 rounded-3xl text-white relative overflow-hidden">
                            <h4 class="font-black mb-2 text-lg">طلب ملزمة خاصة؟</h4>
                            <p class="text-xs text-primary-200 mb-6 font-bold">إذا كنت تبحث عن موضوع معين ولم تجده، راسلنا فوراً.</p>
                            <button class="w-full py-3 bg-white text-primary-900 rounded-xl font-bold shadow-lg">تواصل معنا</button>
                            <i class="fa-solid fa-paper-plane absolute -bottom-4 -left-4 text-7xl text-white/10 -rotate-12"></i>
                        </div>
                    </aside>

                    <!-- Library Grid -->
                    <div class="lg:col-span-3">
                        <div class="bg-white p-4 rounded-3xl mb-8 flex flex-col md:flex-row gap-4 items-center justify-between shadow-sm">
                            <div class="relative w-full md:w-96">
                                <i class="fa-solid fa-magnifying-glass absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="lib-search" placeholder="ابحث عن اسم الملزمة..." class="w-full pr-12 pl-4 py-3 bg-gray-50 rounded-2xl border-none outline-none focus:ring-2 focus:ring-primary-100 font-bold">
                            </div>
                            <div class="flex items-center gap-3 px-4 py-2 bg-blue-50 text-primary-900 rounded-xl font-black text-xs">
                                <i class="fa-solid fa-sort"></i> ترتيب حسب: الأحدث
                            </div>
                        </div>
                        <div id="library-full-grid" class="grid sm:grid-cols-2 xl:grid-cols-3 gap-6">
                            <!-- Dynamic Content -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: EXAMS -->
        <section id="section-exams" class="view-section hidden py-10">
            <div class="max-w-4xl mx-auto px-4">
                <div class="bg-white p-10 rounded-4xl shadow-premium text-center border border-gray-100">
                    <div class="w-24 h-24 bg-purple-100 rounded-3xl flex items-center justify-center text-purple-600 text-4xl mx-auto mb-8 shadow-inner">
                        <i class="fa-solid fa-pen-fancy"></i>
                    </div>
                    <h2 class="text-3xl font-black text-gray-900 mb-6">مركز الاختبارات الإلكترونية</h2>
                    <p class="text-gray-500 font-bold mb-10 leading-relaxed max-w-lg mx-auto">
                        تحدّ نفسك وقم بقياس مستواك الحقيقي مع اختباراتنا الشاملة. يتم التصحيح تلقائياً مع تزويدك بتقرير مفصل عن نقاط القوة والضعف.
                    </p>
                    <div id="exams-container" class="space-y-4 text-right">
                        <!-- Dynamic Content -->
                        <div class="p-6 bg-gray-50 rounded-3xl border-2 border-dashed border-gray-200 text-center text-gray-400 font-bold">
                            لا توجد اختبارات متاحة حالياً لصفك الدراسي
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: ADMIN PANEL -->
        <section id="section-admin" class="view-section hidden py-8">
            <div class="max-w-[1400px] mx-auto px-4">
                <div class="grid lg:grid-cols-12 gap-8">
                    
                    <!-- Sidebar Navigation -->
                    <aside class="lg:col-span-3 space-y-4">
                        <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
                            <h3 class="font-black text-primary-900 mb-8 px-4 border-r-4 border-primary-600 pr-4">إدارة المنصة</h3>
                            <nav class="flex flex-col gap-2">
                                <button onclick="window.adminNav('dashboard')" class="admin-nav-btn active flex items-center gap-4 px-6 py-4 rounded-2xl bg-primary-800 text-white font-black transition shadow-lg">
                                    <i class="fa-solid fa-chart-line text-lg w-6"></i> الإحصائيات العامة
                                </button>
                                <button onclick="window.adminNav('add-content')" class="admin-nav-btn flex items-center gap-4 px-6 py-4 rounded-2xl text-gray-500 font-bold hover:bg-gray-50 transition">
                                    <i class="fa-solid fa-plus-circle text-lg w-6"></i> إضافة محتوى
                                </button>
                                <button onclick="window.adminNav('manage-users')" class="admin-nav-btn flex items-center gap-4 px-6 py-4 rounded-2xl text-gray-500 font-bold hover:bg-gray-50 transition">
                                    <i class="fa-solid fa-users-gear text-lg w-6"></i> إدارة المستخدمين
                                </button>
                                <button onclick="window.adminNav('exams-manager')" class="admin-nav-btn flex items-center gap-4 px-6 py-4 rounded-2xl text-gray-500 font-bold hover:bg-gray-50 transition">
                                    <i class="fa-solid fa-scroll text-lg w-6"></i> صانع الاختبارات
                                </button>
                            </nav>
                        </div>
                        <div class="bg-dark text-white p-8 rounded-3xl shadow-premium relative overflow-hidden bg-slate-900">
                            <p class="text-xs text-slate-400 font-bold mb-4 uppercase">نصيحة أمنية</p>
                            <p class="text-sm leading-relaxed font-bold">تأكد دائماً من تسجيل الخروج عند استخدام جهاز عام لحماية بيانات الطلاب والمنصة.</p>
                            <i class="fa-solid fa-shield-halved absolute -bottom-6 -left-6 text-7xl text-white/5 -rotate-12"></i>
                        </div>
                    </aside>

                    <!-- Content Panel -->
                    <div class="lg:col-span-9 space-y-8">
                        
                        <!-- Panel: Dashboard -->
                        <div id="admin-panel-dashboard" class="admin-panel space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center justify-center">
                                    <p class="text-xs font-black text-gray-400 mb-2 uppercase">إجمالي المبيعات</p>
                                    <p class="text-4xl font-black text-primary-900">0 <span class="text-sm font-bold text-gray-400 mr-2">ج.م</span></p>
                                </div>
                                <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center justify-center">
                                    <p class="text-xs font-black text-gray-400 mb-2 uppercase">المشاهدات النشطة</p>
                                    <p class="text-4xl font-black text-success">0</p>
                                </div>
                                <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center justify-center">
                                    <p class="text-xs font-black text-gray-400 mb-2 uppercase">ملازم محملة اليوم</p>
                                    <p class="text-4xl font-black text-warning">0</p>
                                </div>
                            </div>
                            <div class="bg-white p-8 rounded-4xl shadow-sm border border-gray-100">
                                <h4 class="font-black text-xl mb-10">تحليل النمو الأسبوعي</h4>
                                <canvas id="growthChart" height="120"></canvas>
                            </div>
                        </div>

                        <!-- Panel: Add Content -->
                        <div id="admin-panel-add-content" class="admin-panel hidden animate__animated animate__fadeIn">
                            <div class="bg-white p-8 md:p-12 rounded-4xl shadow-premium border border-gray-100">
                                <div class="flex flex-wrap gap-4 mb-10">
                                    <button onclick="window.setEntryType('course')" class="entry-type-btn active flex-1 py-4 px-6 rounded-2xl bg-primary-800 text-white font-black shadow-lg transition">إضافة كورس فيديو</button>
                                    <button onclick="window.setEntryType('book')" class="entry-type-btn flex-1 py-4 px-6 rounded-2xl bg-gray-50 text-gray-500 font-bold hover:bg-gray-100 transition">إضافة ملزمة PDF</button>
                                </div>

                                <form id="globalAdminForm" class="space-y-6">
                                    <input type="hidden" id="adminEntryType" value="course">
                                    <div class="grid md:grid-cols-2 gap-6">
                                        <div class="space-y-2">
                                            <label class="text-xs font-black text-gray-500 uppercase px-4">عنوان المحتوى</label>
                                            <input type="text" id="adminTitle" placeholder="مثال: شرح درس النحو" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border border-transparent focus:border-primary-600 focus:bg-white transition font-bold" required>
                                        </div>
                                        <div class="space-y-2">
                                            <label class="text-xs font-black text-gray-500 uppercase px-4">الصف الدراسي</label>
                                            <select id="adminLevel" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border border-transparent focus:border-primary-600 focus:bg-white transition font-bold">
                                                <option value="1sec">الصف الأول الثانوي</option>
                                                <option value="2sec">الصف الثاني الثانوي</option>
                                                <option value="3sec">الصف الثالث الثانوي</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-xs font-black text-gray-500 uppercase px-4">الرابط المباشر (Video/PDF Link)</label>
                                        <input type="text" id="adminLink" placeholder="انسخ الرابط هنا..." class="w-full p-4 bg-gray-50 rounded-2xl outline-none border border-transparent focus:border-primary-600 focus:bg-white transition font-bold" required>
                                    </div>
                                    <div id="courseOnlyFields" class="grid md:grid-cols-2 gap-6">
                                        <div class="space-y-2">
                                            <label class="text-xs font-black text-gray-500 uppercase px-4">السعر (ج.م)</label>
                                            <input type="number" id="adminPrice" placeholder="اتركه فارغاً إذا كان مجاني" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border border-transparent focus:border-primary-600 focus:bg-white transition font-bold">
                                        </div>
                                        <div class="space-y-2">
                                            <label class="text-xs font-black text-gray-500 uppercase px-4">مدة الفيديو (بالدقائق)</label>
                                            <input type="number" id="adminDuration" placeholder="اختياري" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border border-transparent focus:border-primary-600 focus:bg-white transition font-bold">
                                        </div>
                                    </div>
                                    <div class="pt-6">
                                        <button type="submit" class="w-full py-5 bg-primary-800 text-white font-black text-lg rounded-3xl shadow-premium hover:opacity-90 transition-all flex items-center justify-center gap-4">
                                            <i class="fa-solid fa-cloud-arrow-up"></i> حفظ ونشر المحتوى
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Panel: Exams Manager -->
                        <div id="admin-panel-exams-manager" class="admin-panel hidden animate__animated animate__fadeIn">
                            <div class="bg-white p-10 rounded-4xl shadow-sm text-center">
                                <i class="fa-solid fa-vials text-6xl text-gray-200 mb-6"></i>
                                <h3 class="text-xl font-black mb-4">وحدة بناء الاختبارات</h3>
                                <p class="text-gray-500 font-bold mb-8">هذه الميزة تتيح لك إنشاء أسئلة اختيار من متعدد مع تحديد الإجابة الصحيحة.</p>
                                <button class="px-10 py-4 bg-primary-800 text-white rounded-2xl font-black shadow-lg">إنشاء اختبار جديد</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Global Video Player Modal -->
    <div id="global-video-modal" class="fixed inset-0 z-[500] bg-black/95 hidden flex flex-col items-center justify-center p-4 backdrop-blur-md">
        <div class="w-full max-w-6xl relative flex flex-col">
            <div class="flex justify-between items-center mb-6 px-4">
                <h3 id="video-playing-title" class="text-white font-black text-xl truncate max-w-md"></h3>
                <button onclick="window.closeVideo()" class="w-14 h-14 bg-white/10 hover:bg-red-600 text-white rounded-full transition-all text-2xl flex items-center justify-center shadow-lg">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="w-full aspect-video rounded-3xl overflow-hidden bg-black shadow-premium border border-white/10">
                <iframe id="global-iframe" class="w-full h-full" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div class="mt-8 px-6 py-4 bg-white/5 backdrop-blur-xl rounded-3xl border border-white/5">
                <p class="text-white/60 font-bold text-sm"><i class="fa-solid fa-circle-info ml-2"></i> تأكد من وجود اتصال قوي بالإنترنت لمتابعة المحاضرة بجودة عالية.</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-primary-950 text-white pt-20 pb-10 mt-20 relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-12 mb-20">
                <div class="space-y-6">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-900 font-black text-2xl">م</div>
                        <h4 class="text-2xl font-black">محمد جابر</h4>
                    </div>
                    <p class="text-primary-200 text-sm leading-relaxed font-bold">المنصة التعليمية الأولى المتخصصة في تدريس اللغة العربية للمرحلة الثانوية بأسلوب عصري ومبتكر يضمن التفوق والتميز.</p>
                    <div class="flex gap-4">
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white hover:text-primary-900 transition"><i class="fa-brands fa-facebook-f"></i></a>
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white hover:text-primary-900 transition"><i class="fa-brands fa-youtube"></i></a>
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white hover:text-primary-900 transition"><i class="fa-brands fa-whatsapp"></i></a>
                    </div>
                </div>
                <div>
                    <h5 class="font-black text-lg mb-8 text-gold">روابط سريعة</h5>
                    <ul class="space-y-4 text-sm font-bold text-primary-100">
                        <li><a href="#" class="hover:text-white transition">عن الأستاذ</a></li>
                        <li><a href="#" class="hover:text-white transition">المسارات الدراسية</a></li>
                        <li><a href="#" class="hover:text-white transition">جدول المحاضرات</a></li>
                        <li><a href="#" class="hover:text-white transition">سياسة الخصوصية</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-black text-lg mb-8 text-gold">تواصل معنا</h5>
                    <ul class="space-y-4 text-sm font-bold text-primary-100">
                        <li class="flex items-center gap-3"><i class="fa-solid fa-location-dot text-gold"></i> القاهرة، مدينة نصر</li>
                        <li class="flex items-center gap-3"><i class="fa-solid fa-phone text-gold"></i> +20 100 000 0000</li>
                        <li class="flex items-center gap-3"><i class="fa-solid fa-envelope text-gold"></i> info@mohamedjaber.com</li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-black text-lg mb-8 text-gold">النشرة البريدية</h5>
                    <p class="text-xs text-primary-200 mb-6 font-bold">اشترك لتصلك أحدث الملازم والتدريبات فور صدورها.</p>
                    <div class="flex gap-2">
                        <input type="email" placeholder="بريدك الإلكتروني" class="flex-grow bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-sm outline-none focus:bg-white/20 transition">
                        <button class="px-4 py-3 bg-white text-primary-900 rounded-xl font-bold hover:bg-gold hover:text-white transition shadow-lg">اشترك</button>
                    </div>
                </div>
            </div>
            <div class="border-t border-white/10 pt-10 text-center flex flex-col md:flex-row justify-between items-center gap-6">
                <p class="text-xs font-bold text-primary-400">جميع الحقوق محفوظة © 2024 - منصة الأستاذ محمد جابر التعليمية</p>
                <div class="flex gap-6 text-xs font-bold text-primary-400">
                    <a href="#" class="hover:text-white">شروط الاستخدام</a>
                    <a href="#" class="hover:text-white">المساعدة</a>
                </div>
            </div>
        </div>
        <!-- Footer Shapes -->
        <div class="absolute top-0 right-0 w-96 h-96 bg-primary-800/20 rounded-full blur-[100px] -translate-y-1/2"></div>
    </footer>

    <!-- Core Application Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Constants & Configuration
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Local Application State
        const AppState = {
            user: JSON.parse(localStorage.getItem('jaber_pro_user')) || null,
            adminEmail: "admin@teacher.com",
            courses: [],
            books: [],
            exams: [],
            activeFilter: 'all',
            isHeaderShrunk: false,
            notifications: []
        };

        // --- Core Functions ---

        /**
         * Initialize Application
         */
        async function initApp() {
            try {
                await signInAnonymously(auth);
                setupCoreListeners();
                setupGlobalScrollHandler();
                setupAuthDisplay();
                setupAnimations();
                
                // Close loader after minimal delay for UX
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                }, 1200);
            } catch (error) {
                console.error("Initialization Failed:", error);
                Swal.fire('خطأ في الاتصال', 'يرجى التحقق من اتصالك بالإنترنت', 'error');
            }
        }

        /**
         * Firestore Data Listeners
         */
        function setupCoreListeners() {
            // Courses Listener
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'courses'), (snap) => {
                AppState.courses = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderCourseGalleries();
            });

            // Library Listener
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'books'), (snap) => {
                AppState.books = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderLibraryGallery();
            });
        }

        /**
         * Routing & Section Management
         */
        window.router = (sectionId) => {
            const allSections = document.querySelectorAll('.view-section');
            const targetSection = document.getElementById(`section-${sectionId}`);
            const allNavLinks = document.querySelectorAll('.nav-link');

            if (!targetSection) return;

            // Update UI State
            allSections.forEach(s => s.classList.add('hidden'));
            targetSection.classList.remove('hidden');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Close mobile menu
            document.getElementById('mobile-drawer').classList.add('hidden');

            // Handle specific section inits
            if (sectionId === 'admin') initAdminDashboard();
            if (sectionId === 'home') runCounters();
        };

        /**
         * Auth Handlers
         */
        window.handleCredentialResponse = (response) => {
            try {
                const payload = JSON.parse(atob(response.credential.split('.')[1]));
                const userObj = {
                    id: payload.sub,
                    name: payload.name,
                    email: payload.email,
                    picture: payload.picture,
                    isAdmin: payload.email === AppState.adminEmail
                };

                AppState.user = userObj;
                localStorage.setItem('jaber_pro_user', JSON.stringify(userObj));
                setupAuthDisplay();
                
                Swal.fire({
                    title: `مرحباً بك يا ${userObj.name}`,
                    text: 'تم تسجيل دخولك بنجاح للمنصة',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
            } catch (err) {
                console.error("Auth Decode Error:", err);
            }
        };

        window.logout = () => {
            Swal.fire({
                title: 'هل تريد الخروج؟',
                text: "سيتعين عليك تسجيل الدخول مرة أخرى للوصول للمحاضرات",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#1e40af',
                cancelButtonColor: '#d33',
                confirmButtonText: 'نعم، سجل الخروج',
                cancelButtonText: 'إلغاء'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.removeItem('jaber_pro_user');
                    AppState.user = null;
                    location.reload();
                }
            });
        };

        function setupAuthDisplay() {
            const authContainer = document.getElementById('google-auth-container');
            const userContext = document.getElementById('user-context');
            const adminBtn = document.getElementById('mobile-admin-btn');
            const navAdmin = document.getElementById('nav-admin');

            if (AppState.user) {
                authContainer.classList.add('hidden');
                userContext.classList.remove('hidden');
                document.getElementById('user-avatar').src = AppState.user.picture;
                document.getElementById('user-display-name').textContent = AppState.user.name;
                
                if (AppState.user.isAdmin) {
                    adminBtn?.classList.remove('hidden');
                    navAdmin?.classList.remove('hidden');
                    document.getElementById('user-role-label').textContent = 'مدير المنصة';
                }
            } else {
                authContainer.classList.remove('hidden');
                userContext.classList.add('hidden');
                // GSI Button setup
                google.accounts.id.initialize({
                    client_id: "583210084990-m5j5pkdp63s255aci47grhdhef5rfk9s.apps.googleusercontent.com",
                    callback: window.handleCredentialResponse
                });
                google.accounts.id.renderButton(
                    document.getElementById("g_id_signin"),
                    { theme: "outline", size: "large", text: "signin_with", shape: "pill" }
                );
            }
        }

        /**
         * Course Filtering & Rendering
         */
        window.filterCourses = (level) => {
            AppState.activeFilter = level;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-primary-800', 'text-white');
                btn.classList.add('text-gray-500');
            });
            event.target.classList.add('active', 'bg-primary-800', 'text-white');
            event.target.classList.remove('text-gray-500');
            renderCourseGalleries();
        };

        function renderCourseGalleries() {
            const fullGrid = document.getElementById('courses-full-grid');
            const featuredGrid = document.getElementById('featured-courses-grid');
            
            const filtered = AppState.activeFilter === 'all' 
                ? AppState.courses 
                : AppState.courses.filter(c => c.level === AppState.activeFilter);

            const courseCard = (c) => `
                <div class="group relative bg-white rounded-3xl p-5 shadow-sm border border-gray-100 hover:shadow-premium transition-all duration-500 animate__animated animate__fadeInUp">
                    <div class="relative w-full aspect-video rounded-2xl overflow-hidden mb-6 bg-primary-50">
                        <img src="https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?auto=format&fit=crop&q=80&w=400" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 opacity-20">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <i class="fa-solid fa-play text-4xl text-primary-200 group-hover:text-primary-600 transition-colors"></i>
                        </div>
                        <div class="absolute top-4 right-4 px-3 py-1 bg-white/90 backdrop-blur rounded-lg text-[10px] font-black text-primary-900 shadow-sm">
                            ${c.level === '3sec' ? 'الصف الثالث' : c.level === '2sec' ? 'الصف الثاني' : 'الصف الأول'}
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center gap-2 text-[10px] font-bold text-gray-400">
                            <span class="flex items-center gap-1"><i class="fa-solid fa-clock"></i> ${c.duration || '--'} دقيقة</span>
                            <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                            <span class="flex items-center gap-1"><i class="fa-solid fa-eye"></i> 1.2k مشاهدة</span>
                        </div>
                        <h3 class="font-black text-gray-800 text-lg group-hover:text-primary-800 transition-colors line-clamp-2 min-h-[3.5rem]">${c.title}</h3>
                        <div class="flex items-center justify-between pt-4 border-t border-gray-50">
                            <span class="text-primary-900 font-black text-xl">${c.price ? c.price + ' <span class="text-xs">ج.م</span>' : '<span class="text-success">مجاني</span>'}</span>
                            <button onclick="window.watchVideo('${c.link}', '${c.title}')" class="px-6 py-2.5 bg-primary-800 text-white rounded-xl text-xs font-black shadow-lg shadow-primary-200 hover:scale-105 active:scale-95 transition-all">
                                مشاهدة المحاضرة
                            </button>
                        </div>
                    </div>
                </div>
            `;

            if (fullGrid) fullGrid.innerHTML = filtered.length ? filtered.map(courseCard).join('') : `<div class="col-span-full py-20 text-center font-bold text-gray-300">لا توجد محاضرات في هذا القسم حالياً</div>`;
            if (featuredGrid) featuredGrid.innerHTML = AppState.courses.slice(0, 3).map(courseCard).join('');
        }

        /**
         * Library Rendering
         */
        function renderLibraryGallery() {
            const grid = document.getElementById('library-full-grid');
            if (!grid) return;

            grid.innerHTML = AppState.books.length ? AppState.books.map(b => `
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 flex items-start gap-5 hover:shadow-premium transition-all animate__animated animate__zoomIn">
                    <div class="w-16 h-16 bg-red-50 rounded-2xl flex items-center justify-center text-red-500 text-2xl flex-shrink-0">
                        <i class="fa-solid fa-file-pdf"></i>
                    </div>
                    <div class="flex-grow">
                        <h4 class="font-black text-gray-800 mb-2 leading-tight line-clamp-2">${b.title}</h4>
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-[10px] font-bold text-gray-400">PDF • 2.4 MB</span>
                            <span class="text-[10px] font-bold text-primary-600 bg-primary-50 px-2 py-0.5 rounded-md">جديد</span>
                        </div>
                        <a href="${b.link}" target="_blank" class="flex items-center justify-center gap-2 w-full py-2 bg-gray-50 text-gray-600 rounded-xl text-xs font-black hover:bg-red-500 hover:text-white transition-all">
                            <i class="fa-solid fa-download"></i> تحميل الآن
                        </a>
                    </div>
                </div>
            `).join('') : `<div class="col-span-full py-20 text-center font-bold text-gray-300">المكتبة فارغة حالياً</div>`;
        }

        /**
         * Video Player Logic
         */
        window.watchVideo = (link, title) => {
            if (!AppState.user) {
                return Swal.fire({
                    title: 'تنبيه',
                    text: 'يجب عليك تسجيل الدخول بحساب جوجل لمشاهدة المحاضرات',
                    icon: 'info',
                    confirmButtonText: 'فهمت'
                });
            }

            // Simple YouTube Parser
            let videoId = '';
            if (link.includes('v=')) videoId = link.split('v=')[1].split('&')[0];
            else if (link.includes('youtu.be/')) videoId = link.split('youtu.be/')[1].split('?')[0];
            else videoId = link.split('/').pop();

            document.getElementById('video-playing-title').textContent = title;
            document.getElementById('global-iframe').src = `https://www.youtube.com/embed/${videoId}?autoplay=1&modestbranding=1&rel=0`;
            document.getElementById('global-video-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };

        window.closeVideo = () => {
            document.getElementById('global-video-modal').classList.add('hidden');
            document.getElementById('global-iframe').src = '';
            document.body.style.overflow = 'auto';
        };

        /**
         * Admin Dashboard Management
         */
        window.adminNav = (tabId) => {
            document.querySelectorAll('.admin-panel').forEach(p => p.classList.add('hidden'));
            document.getElementById(`admin-panel-${tabId}`).classList.remove('hidden');

            document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-primary-800', 'text-white', 'shadow-lg');
                btn.classList.add('text-gray-500');
            });
            event.currentTarget.classList.add('active', 'bg-primary-800', 'text-white', 'shadow-lg');
            event.currentTarget.classList.remove('text-gray-500');
        };

        window.setEntryType = (type) => {
            document.getElementById('adminEntryType').value = type;
            document.getElementById('courseOnlyFields').classList.toggle('hidden', type !== 'course');
            
            document.querySelectorAll('.entry-type-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-primary-800', 'text-white', 'shadow-lg');
                btn.classList.add('bg-gray-50', 'text-gray-500');
            });
            event.target.classList.add('active', 'bg-primary-800', 'text-white', 'shadow-lg');
            event.target.classList.remove('bg-gray-50', 'text-gray-500');
        };

        function initAdminDashboard() {
            if (!AppState.user?.isAdmin) {
                router('home');
                return Swal.fire('وصول ممنوع', 'هذه المنطقة للمسؤولين فقط', 'error');
            }
            
            // Render Growth Chart
            const ctx = document.getElementById('growthChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['السبت', 'الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة'],
                    datasets: [{
                        label: 'المستخدمين الجدد',
                        data: [65, 59, 80, 81, 56, 55, 40],
                        borderColor: '#1e40af',
                        backgroundColor: 'rgba(30, 64, 175, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        /**
         * Form Submissions
         */
        document.getElementById('globalAdminForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const type = document.getElementById('adminEntryType').value;
            const btn = e.target.querySelector('button');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner animate-spin"></i> جاري الحفظ...';

            const payload = {
                title: document.getElementById('adminTitle').value,
                link: document.getElementById('adminLink').value,
                level: document.getElementById('adminLevel').value,
                createdAt: new Date().toISOString(),
                author: AppState.user.name
            };

            if (type === 'course') {
                payload.price = document.getElementById('adminPrice').value;
                payload.duration = document.getElementById('adminDuration').value;
            }

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', type + 's'), payload);
                Swal.fire('نجاح العملية', 'تم نشر المحتوى الجديد بنجاح على المنصة', 'success');
                e.target.reset();
            } catch (err) {
                Swal.fire('خطأ', 'فشل حفظ البيانات في فايربيز', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-cloud-arrow-up"></i> حفظ ونشر المحتوى';
            }
        });

        // --- Utilities & UI Helpers ---

        function setupGlobalScrollHandler() {
            window.addEventListener('scroll', () => {
                const header = document.getElementById('main-header');
                if (window.scrollY > 50) {
                    header.classList.add('glass', 'shadow-sm', 'h-16');
                    header.classList.remove('h-20');
                } else {
                    header.classList.remove('glass', 'shadow-sm', 'h-16');
                    header.classList.add('h-20');
                }
            });
        }

        window.toggleMobileMenu = () => {
            const drawer = document.getElementById('mobile-drawer');
            drawer.classList.toggle('hidden');
        };

        function runCounters() {
            const counters = document.querySelectorAll('.counter');
            counters.forEach(counter => {
                const target = +counter.getAttribute('data-target');
                const count = +counter.innerText;
                const speed = 200;
                const inc = target / speed;

                const updateCount = () => {
                    const current = +counter.innerText;
                    if (current < target) {
                        counter.innerText = Math.ceil(current + inc);
                        setTimeout(updateCount, 1);
                    } else {
                        counter.innerText = target;
                    }
                };
                updateCount();
            });
        }

        function setupAnimations() {
            // Animate items on viewport enter if needed
            gsap.from(".glass-card", {
                duration: 1,
                y: 50,
                opacity: 0,
                stagger: 0.2,
                ease: "power2.out"
            });
        }

        // Initialize Everything
        window.onload = initApp;

    </script>
</body>
</html>
